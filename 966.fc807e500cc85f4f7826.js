(self.webpackChunkimageannotator=self.webpackChunkimageannotator||[]).push([[966],{98458:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Zo});var o=n(77865),r=n.n(o),i=n(21704),a=n.n(i),s=n(96156),l=n(92137),c=n(85061),u=n(28481),d=n(87757),g=n.n(d),m=n(5034),f=n(26975),h=n(96533),p=n(80983),y=n(54153),v=n(81253),E=n(41120),b=n(11476),w=n(78655);const x=function(e){var t=e.mousePosition,n=e.x,i=e.y,a=(0,o.useState)(),s=(0,u.Z)(a,2),l=(s[0],s[1]);return t&&(n=t.current.x,i=t.current.y),(0,o.useEffect)((function(){if(t){var e=setInterval((function(){n===t.current.x&&i===t.current.y||l([t.current.x,t.current.y])}),10);return function(){return clearInterval(e)}}})),r().createElement(o.Fragment,null,r().createElement("div",{style:{position:"absolute",height:"100%",width:1,zIndex:10,backgroundColor:"#f00",left:n,pointerEvents:"none",top:0}}),r().createElement("div",{style:{position:"absolute",width:"100%",zIndex:10,height:1,backgroundColor:"#f00",top:i,pointerEvents:"none",left:0}}))};var I=n(76839),Z=n(93355),T=(0,b.Z)("div")({"& > div":{width:"100%",height:"100%"}});const k=function(e){var t=e.children,n=(0,v.Z)(e,["children"]),i=(0,o.useState)(!1),a=(0,u.Z)(i,2),s=a[0],l=a[1],c=(0,Z.Z)((function(e){s||l(!0),n.onMouseMove&&n.onMouseMove(e)})),d=(0,Z.Z)((function(e){setTimeout((function(){s&&l(!1)}),100)}));return r().createElement(T,Object.assign({},n,{onMouseMove:c,onMouseLeave:d}),r().createElement(I.Z,{enabled:s,removeScrollBar:!1},t))};var O=n(74586),S=n(43337);var M=n(90484);var N=(0,b.Z)("svg")({pointerEvents:"none",position:"absolute",zIndex:1,left:0,top:0,width:"100%",height:"100%","& text":{fill:"#fff"},"& path":{vectorEffect:"non-scaling-stroke",strokeWidth:2,opacity:.5,stroke:"#FFF",fill:"none",strokeDasharray:5,animationDuration:"4s",animationTimingFunction:"linear",animationIterationCount:"infinite",animationPlayState:"running"}});const _=function(e){var t=e.projectRegionBox,n=e.regions,i=e.pointDistancePrecision,a=e.realSize;return r().createElement(N,null,n.filter((function(e){return"point"===e.type})).flatMap((function(e,s){return n.filter((function(e,t){return t>s})).filter((function(e){return"point"===e.type})).map((function(n){var s,l=t(e),c=t(n),u={x:(l.x+l.w/2+c.x+c.w/2)/2,y:(l.y+l.h/2+c.y+c.h/2)/2};if(a){var d=a.w,g=a.h,m=a.unitName;s=Math.sqrt(Math.pow(e.x*d-n.x*d,2)+Math.pow(e.y*g-n.y*g,2)).toFixed(i)+m}else s=(100*Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))).toFixed(i)+"%";return r().createElement(o.Fragment,null,r().createElement("path",{d:"M".concat(l.x+l.w/2,",").concat(l.y+l.h/2," L").concat(c.x+c.w/2,",").concat(c.y+c.h/2)}),r().createElement("text",{x:u.x,y:u.y},s))}))})))};var A=n(79895),C=n(88105);const R={regionInfo:{fontSize:12,cursor:"default",transition:"opacity 200ms",opacity:.5,"&:hover":{opacity:.9,cursor:"pointer"},"&.highlighted":{opacity:.9,"&:hover":{opacity:1}},fontWeight:600,color:C.Z[900],padding:8,"& .name":{display:"flex",flexDirection:"row",alignItems:"center","& .circle":{marginRight:4,boxShadow:"0px 0px 2px rgba(0,0,0,0.4)",width:10,height:10,borderRadius:5}},"& .tags":{"& .tag":{color:C.Z[700],display:"inline-block",margin:1,fontSize:10,textDecoration:"underline"}}}};var L=n(94184),D=n.n(L),P=n(17812),j=n(282),z=n(28428),B=n(41959),W=n(55519),G=n(12766),H=n(33042),V=n.n(H),U=(0,E.Z)(R),F=function(e){var t=e.region,n=e.editing,o=e.allowedClasses,i=e.allowedTags,a=e.onDelete,s=e.onChange,l=e.onClose,c=e.onOpen,u=e.onRegionClassAdded,d=U();return r().createElement(A.Z,{onClick:function(){return n?null:c(t)},className:D()(d.regionInfo,{highlighted:t.highlighted})},n?r().createElement("div",{style:{width:200}},r().createElement("div",{style:{display:"flex",flexDirection:"row"}},r().createElement("div",{style:{display:"flex",backgroundColor:t.color||"#888",color:"#fff",padding:4,paddingLeft:8,paddingRight:8,borderRadius:4,fontWeight:"bold",textShadow:"0px 0px 5px rgba(0,0,0,0.4)"}},t.type),r().createElement("div",{style:{flexGrow:1}}),r().createElement(P.Z,{onClick:function(){return a(t)},tabIndex:-1,style:{width:22,height:22},size:"small",variant:"outlined"},r().createElement(z.default,{style:{marginTop:-8,width:16,height:16}}))),(o||[]).length>0&&r().createElement("div",{style:{marginTop:6}},r().createElement(G.ZP,{placeholder:"Classification",onChange:function(e,n){return"create-option"==n.action&&u(e.value),s((0,y.Z)({},t,{cls:e.value}))},value:t.cls?{label:t.cls,value:t.cls}:null,options:(0,H.asMutable)(o.map((function(e){return{value:e,label:e}})))})),(i||[]).length>0&&r().createElement("div",{style:{marginTop:4}},r().createElement(W.default,{onChange:function(e){return s((0,y.Z)({},t,{tags:e.map((function(e){return e.value}))}))},placeholder:"Tags",value:(t.tags||[]).map((function(e){return{label:e,value:e}})),isMulti:!0,options:(0,H.asMutable)(i.map((function(e){return{value:e,label:e}})))})),l&&r().createElement("div",{style:{marginTop:4,display:"flex"}},r().createElement("div",{style:{flexGrow:1}}),r().createElement(j.Z,{onClick:function(){return l(t)},size:"small",variant:"contained",color:"primary"},r().createElement(B.default,null)))):r().createElement("div",null,t.cls&&r().createElement("div",{className:"name"},r().createElement("div",{className:"circle",style:{backgroundColor:t.color}}),t.cls),t.tags&&r().createElement("div",{className:"tags"},t.tags.map((function(e){return r().createElement("div",{key:e,className:"tag"},e)})))))};const Y=(0,o.memo)(F,(function(e,t){return e.editing===t.editing&&e.region===t.region}));var K=n(44080);const X=function(e){var t=e.regions,n=e.projectRegionBox,o=e.mouseEvents,i=e.regionClsList,a=e.regionTagList,s=e.onBeginRegionEdit,l=e.onChangeRegion,c=e.onCloseRegionEdit,u=e.onDeleteRegion,d=e.layoutParams,g=e.imageSrc,m=e.RegionEditLabel,f=e.onRegionClassAdded,h=null!=m?m:Y;return t.filter((function(e){return e.visible||void 0===e.visible})).map((function(e){var m=n(e),p=d.current,v=(p.iw,p.ih,8);e.highlighted&&"box"===e.type&&(v+=6);var E=e.editingLabels&&!e.locked?170:e.tags?60:50,b=m.y>E,w=b?{left:m.x,top:m.y-v/2}:{left:m.x,top:m.y+m.h+v/2};return e.locked?r().createElement("div",{key:e.id,style:(0,y.Z)({position:"absolute"},w,{zIndex:10+(e.editingLabels?5:0)})},r().createElement(A.Z,{style:(0,y.Z)({position:"absolute",left:0},b?{bottom:0}:{top:0},{zIndex:10,backgroundColor:"#fff",borderRadius:4,padding:2,paddingBottom:0,opacity:.5,pointerEvents:"none"})},r().createElement(K.Z,{style:{width:16,height:16,color:"#333"}}))):r().createElement("div",{key:e.id,style:(0,y.Z)({position:"absolute"},w,{zIndex:10+(e.editingLabels?5:0),width:200}),onMouseDown:function(e){return e.preventDefault()},onMouseUp:function(e){return e.preventDefault()},onMouseEnter:function(t){e.editingLabels&&(o.onMouseUp(t),t.button=1,o.onMouseUp(t))}},r().createElement("div",Object.assign({style:(0,y.Z)({position:"absolute",zIndex:20,left:0},b?{bottom:0}:{top:0})},e.editingLabels?{}:function(e){for(var t=(0,y.Z)({},e),n=arguments.length,o=new Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];for(var i=0,a=o;i<a.length;i++)delete t[a[i]];return t}(o,"onMouseDown","onMouseUp")),r().createElement(h,{allowedClasses:i,allowedTags:a,onOpen:s,onChange:l,onClose:c,onDelete:u,editing:e.editingLabels,region:e,regions:t,imageSrc:g,onRegionClassAdded:f})))}))};var q=n(20907),J=n(96230),$=n(18334),Q=n(59546),ee=n(75659),te=n(32315),ne=n(9198),oe=n(29791),re=n(34446),ie=n(49604),ae=n(45514),se=n(35442),le=[q.Z[500],J.Z[500],$.Z[500],Q.Z[800],ee.Z[500],te.Z[700],ne.Z[500],oe.Z[500],re.Z[500],ie.Z[500],ae.Z[500],se.Z[500]];le.map((function(e){return(2281701376|(n=(t=(t=e).replace("#","")).substr(4,2)+t.substr(2,2)+t.substr(0,2),parseInt(n,16)))>>>0;var t,n}));const ce=le;var ue=n(84730);var de=n(39090),ge=n.n(de);const me=function(e){var t=e.regions,n=e.regionClsList,i=e.imageSrc,a=e.imagePosition,s=e.zIndex,l=void 0===s?1:s,c=e.hide,d=void 0!==c&&c,g=e.autoSegmentationOptions,m=void 0===g?{type:"simple"}:g,f=(0,o.useState)(null),h=(0,u.Z)(f,2),p=h[0],v=h[1],E=(0,o.useState)(),b=(0,u.Z)(E,2),w=b[0],x=b[1];(0,o.useEffect)((function(){i&&function(e){var t=Array.from(document.getElementsByTagName("img")).find((function(t){return t.src===e})),n=document.createElement("canvas"),o=n.getContext("2d");return t||((t=new Image).crossOrigin="anonymous",t.src=e),new Promise((function(e,r){t.onload=function(){n.width=t.naturalWidth,n.height=t.naturalHeight,o.drawImage(t,0,0);var r=o.getImageData(0,0,t.naturalWidth,t.naturalHeight);e(r)}}))}(i).then((function(e){ge().setConfig((0,y.Z)({classNames:n},m)),ge().loadImage(e),x(e)}))}),[i]),(0,ue.Z)((function(){if(!d&&p&&w&&!(t.filter((function(e){return e.cls})).length<2)){var e=function(e){return e.map((function(e){switch(e.type){case"point":return{regionType:"point",classification:e.cls,x:e.x,y:e.y};case"polygon":return{regionType:"polygon",classification:e.cls,points:e.points.map((function(e){var t=(0,u.Z)(e,2);return{x:t[0],y:t[1]}}))};case"box":return{regionType:"bounding-box",classification:e.cls,centerX:e.x+e.w/2,centerY:e.y+e.h/2,width:e.w,height:e.h};default:return null}})).filter(Boolean)}(t);ge().getMask(e).then((function(e){var t=p.getContext("2d");t.clearRect(0,0,e.width,e.height),t.putImageData(e,0,0)}))}}),1e3,[p,w,t,d]);var I=(0,o.useMemo)((function(){var e=a.bottomRight.x-a.topLeft.x,t=a.bottomRight.y-a.topLeft.y;return{display:d?"none":void 0,imageRendering:"pixelated",transform:"translateZ(0px)",left:a.topLeft.x,top:a.topLeft.y,width:isNaN(e)?0:e,height:isNaN(t)?0:t,zIndex:l,position:"absolute",pointerEvents:"none"}}),[a.topLeft.x,a.topLeft.y,a.bottomRight.x,a.bottomRight.y,l,d]);return r().createElement("canvas",{style:I,width:w?w.width:0,height:w?w.height:0,ref:v})};var fe=(0,E.Z)({"@keyframes borderDance":{from:{strokeDashoffset:0},to:{strokeDashoffset:100}},highlightBox:{zIndex:2,transition:"opacity 500ms","&.highlighted":{zIndex:3},"&:not(.highlighted)":{opacity:0},"&:not(.highlighted):hover":{opacity:.6},"& path":{vectorEffect:"non-scaling-stroke",strokeWidth:2,stroke:"#FFF",fill:"none",strokeDasharray:5,animationName:"$borderDance",animationDuration:"4s",animationTimingFunction:"linear",animationIterationCount:"infinite",animationPlayState:"running"}}});const he=function(e){var t=e.mouseEvents,n=e.dragWithPrimary,o=e.zoomWithPrimary,i=e.createWithPrimary,a=e.onBeginMovePoint,s=e.onSelectRegion,l=e.region,c=e.pbox,u=fe();if(!c.w||c.w===1/0)return null;if(!c.h||c.h===1/0)return null;if(l.unfinished)return null;var d="point"===l.type?{left:c.x+c.w/2-30,top:c.y+c.h/2-30,width:60,height:60}:{left:c.x-5,top:c.y-5,width:c.w+10,height:c.h+10},g="point"===l.type?"M5,5 L".concat(d.width-5," 5L").concat(d.width-5," ").concat(d.height-5,"L5 ").concat(d.height-5,"Z"):"M5,5 L".concat(c.w+5,",5 L").concat(c.w+5,",").concat(c.h+5," L5,").concat(c.h+5," Z");return r().createElement("svg",Object.assign({key:l.id,className:D()(u.highlightBox,{highlighted:l.highlighted})},t,o||n?{}:{onMouseDown:function(e){return!l.locked&&"point"===l.type&&l.highlighted&&0===e.button?a(l):0!==e.button||i?void t.onMouseDown(e):s(l)}},{style:(0,y.Z)({},l.highlighted?{pointerEvents:"point"!==l.type?"none":void 0,cursor:"grab"}:{cursor:o||n||i?void 0:"pointer",pointerEvents:o||n||i&&!l.highlighted?"none":void 0},{position:"absolute"},d)}),r().createElement("path",{d:g}))};var pe=(0,b.Z)("div")({width:8,height:8,zIndex:2,border:"2px solid #FFF",position:"absolute"}),ye=[["nw-resize","n-resize","ne-resize"],["w-resize","grab","e-resize"],["sw-resize","s-resize","se-resize"]],ve=function(e,t){return e.region===t.region&&e.dragWithPrimary===t.dragWithPrimary&&e.createWithPrimary===t.createWithPrimary&&e.zoomWithPrimary===t.zoomWithPrimary&&e.mat===t.mat},Ee=(0,o.memo)((function(e){var t=e.region,n=e.mouseEvents,i=e.projectRegionBox,a=e.dragWithPrimary,s=e.createWithPrimary,l=e.zoomWithPrimary,c=e.onBeginMovePoint,d=e.onSelectRegion,g=e.layoutParams,m=(e.fullImageSegmentationMode,e.mat),f=e.onBeginBoxTransform,p=e.onBeginMovePolygonPoint,y=e.onBeginMoveKeypoint,v=e.onAddPolygonPoint,E=e.showHighlightBox,b=i(t),w=g.current,x=w.iw,I=w.ih;return r().createElement(o.Fragment,null,r().createElement(k,null,E&&"polygon"!==t.type&&r().createElement(he,{region:t,mouseEvents:n,dragWithPrimary:a,createWithPrimary:s,zoomWithPrimary:l,onBeginMovePoint:c,onSelectRegion:d,pbox:b}),"box"===t.type&&!a&&!l&&!t.locked&&t.highlighted&&m.a<1.2&&[[0,0],[.5,0],[1,0],[1,.5],[1,1],[.5,1],[0,1],[0,.5],[.5,.5]].map((function(e,o){var i=(0,u.Z)(e,2),a=i[0],s=i[1];return r().createElement(pe,Object.assign({key:o},n,{onMouseDown:function(e){if(0===e.button)return f(t,[2*a-1,2*s-1]);n.onMouseDown(e)},style:{left:b.x-4-2+b.w*a,top:b.y-4-2+b.h*s,cursor:ye[2*s][2*a],borderRadius:.5===a&&.5===s?4:void 0}}))})),"polygon"===t.type&&!a&&!l&&!t.locked&&t.highlighted&&t.points.map((function(e,o){var i=(0,u.Z)(e,2),a=i[0],s=i[1],l=m.clone().inverse().applyToPoint(a*x,s*I);return r().createElement(pe,Object.assign({key:o},n,{onMouseDown:function(e){if(0===e.button&&(!t.open||0===o))return p(t,o);n.onMouseDown(e)},style:{cursor:t.open?0===o?"pointer":void 0:"move",zIndex:10,pointerEvents:t.open&&o===t.points.length-1?"none":void 0,left:l.x-4,top:l.y-4}}))})),"polygon"===t.type&&t.highlighted&&!a&&!l&&!t.locked&&!t.open&&t.points.length>1&&t.points.map((function(e,n){return[e,t.points[(n+1)%t.points.length]]})).map((function(e){var t=(0,u.Z)(e,2),n=t[0],o=t[1];return[(n[0]+o[0])/2,(n[1]+o[1])/2]})).map((function(e,o){var i=m.clone().inverse().applyToPoint(e[0]*x,e[1]*I);return r().createElement(pe,Object.assign({key:o},n,{onMouseDown:function(r){if(0===r.button)return v(t,e,o+1);n.onMouseDown(r)},style:{cursor:"copy",zIndex:10,left:i.x-4,top:i.y-4,border:"2px dotted #fff",opacity:.5}}))})),"keypoints"===t.type&&!a&&!l&&!t.locked&&t.highlighted&&Object.entries(t.points).map((function(e,o){var i=(0,u.Z)(e,2),a=i[0],s=i[1],l=s.x,c=s.y,d=m.clone().inverse().applyToPoint(l*x,c*I);return r().createElement(h.Tooltip,{title:a,key:o},r().createElement(pe,Object.assign({key:o},n,{onMouseDown:function(e){if(0===e.button&&(!t.open||0===o))return y(t,a);n.onMouseDown(e)},style:{cursor:t.open?0===o?"pointer":void 0:"move",zIndex:10,pointerEvents:t.open&&o===t.points.length-1?"none":void 0,left:d.x-4,top:d.y-4}})))}))))}),ve);const be=(0,o.memo)((function(e){return e.regions.filter((function(e){return e.visible||void 0===e.visible})).filter((function(e){return!e.locked})).map((function(t,n){return r().createElement(Ee,Object.assign({key:t.id},e,{region:t}))}))}),(function(e,t){return e.regions===t.regions&&e.mat===t.mat}));var we={showCrosshairs:!1,showHighlightBox:!0,wasdMode:!0},xe=(0,o.createContext)(we),Ie=function(){return(0,o.useContext)(xe)};const Ze=function(e){var t=e.children,n=(0,o.useState)((function(){return function(){if(!window||!window.localStorage)return{};for(var e={},t=0;t<window.localStorage.length;t++){var n=window.localStorage.key(t);if(n.startsWith("settings_"))try{e[n.replace("settings_","")]=JSON.parse(window.localStorage.getItem(n))}catch(e){}}return e}()})),i=(0,u.Z)(n,2),a=i[0],l=i[1];return r().createElement(xe.Provider,{value:(0,y.Z)({},a,{changeSetting:function(e,t){l((0,y.Z)({},a,(0,s.Z)({},e,t))),window.localStorage.setItem("settings_".concat(e),JSON.stringify(t))}})},t)};var Te=(0,b.Z)("video")({zIndex:0,position:"absolute"}),ke=(0,b.Z)("img")({zIndex:0,position:"absolute"}),Oe=(0,b.Z)("div")({zIndex:0,position:"absolute",left:0,right:0,bottom:0,top:0,backgroundColor:"rgba(255,0,0,0.2)",color:"#ff0000",fontWeight:"bold",whiteSpace:"pre-wrap",padding:50});const Se=function(e){var t=e.imagePosition,n=e.mouseEvents,i=e.videoTime,a=e.videoSrc,s=e.imageSrc,l=e.onLoad,c=e.useCrossOrigin,d=void 0!==c&&c,g=e.videoPlaying,m=e.onChangeVideoTime,f=e.onChangeVideoPlaying,h=Ie(),p=(0,o.useRef)(),y=(0,o.useRef)(),v=(0,o.useState)(),E=(0,u.Z)(v,2),b=E[0],w=E[1];(0,o.useEffect)((function(){!g&&p.current&&(p.current.currentTime=(i||0)/1e3)}),[i]),(0,o.useEffect)((function(){var e=!1;return p.current&&(g?(p.current.play(),e=!0,h.videoPlaybackSpeed&&(p.current.playbackRate=parseFloat(h.videoPlaybackSpeed))):p.current.pause()),function t(){if(e&&p.current){var n=Math.floor(1e3*p.current.currentTime);i!==n&&m(n),p.current.paused&&(e=!1,f(!1)),requestAnimationFrame(t)}}(),function(){e=!1}}),[g]);var x=(0,Z.Z)((function(e){var t=e.currentTarget;t.currentTime=(i||0)/1e3,l&&l({naturalWidth:t.videoWidth,naturalHeight:t.videoHeight,videoElm:t,duration:t.duration})})),I=(0,Z.Z)((function(e){var t=e.currentTarget;l&&l({naturalWidth:t.naturalWidth,naturalHeight:t.naturalHeight,imageElm:t})})),T=(0,Z.Z)((function(e){w("Could not load image\n\nMake sure your image works by visiting ".concat(s||a," in a web browser. If that URL works, the server hosting the URL may be not allowing you to access the image from your current domain. Adjust server settings to enable the image to be viewed.").concat(d?"\n\nYour image may be blocked because it's not being sent with CORs headers. To do pixel segmentation, browser web security requires CORs headers in order for the algorithm to read the pixel data from the image. CORs headers are easy to add if you're using an S3 bucket or own the server hosting your images.":"","\n\n If you need a hand, reach out to the community at universaldatatool.slack.com"))})),k=(0,o.useMemo)((function(){var e=t.bottomRight.x-t.topLeft.x,n=t.bottomRight.y-t.topLeft.y;return{imageRendering:"pixelated",left:t.topLeft.x,top:t.topLeft.y,width:isNaN(e)?0:e,height:isNaN(n)?0:n}}),[t.topLeft.x,t.topLeft.y,t.bottomRight.x,t.bottomRight.y]);return a||s?b?r().createElement(Oe,null,b):s&&void 0===i?r().createElement(ke,Object.assign({},n,{src:s,ref:y,style:k,onLoad:I,onError:T,crossOrigin:d?"anonymous":void 0})):r().createElement(Te,Object.assign({},n,{ref:p,style:k,onLoadedMetadata:x,src:a||s})):r().createElement(Oe,null,"No imageSrc or videoSrc provided")};var Me=n(89261);function Ne(e,t,n){return e<=t?t:e>=n?n:e}var _e={point:(0,o.memo)((function(e){var t=e.region,n=e.iw,o=e.ih;return r().createElement("g",{transform:"translate(".concat(t.x*n," ").concat(t.y*o,")")},r().createElement("path",{d:"M0 8L8 0L0 -8L-8 0Z",strokeWidth:2,stroke:t.color,fill:"transparent"}))})),box:(0,o.memo)((function(e){var t=e.region,n=e.iw,o=e.ih;return r().createElement("g",{transform:"translate(".concat(t.x*n," ").concat(t.y*o,")")},r().createElement("rect",{strokeWidth:2,x:0,y:0,width:Math.max(t.w*n,0),height:Math.max(t.h*o,0),stroke:(0,Me.Z)(t.color,.75),fill:(0,Me.Z)(t.color,.25)}))})),polygon:(0,o.memo)((function(e){var t=e.region,n=e.iw,o=e.ih,i=(e.fullSegmentationMode,t.open?"polyline":"polygon");return r().createElement(i,{points:t.points.map((function(e){var t=(0,u.Z)(e,2),r=t[0],i=t[1];return[r*n,i*o]})).map((function(e){return e.join(" ")})).join(" "),strokeWidth:2,stroke:(0,Me.Z)(t.color,.75),fill:(0,Me.Z)(t.color,.25)})})),keypoints:function(e){var t=e.region,n=e.iw,o=e.ih,i=e.keypointDefinitions,a=t.points,s=t.keypointsDefinitionId;if(!i[s])throw new Error('No definition for keypoint configuration "'.concat(s,'"'));var l=i[s],c=l.landmarks,d=l.connections;return r().createElement("g",null,Object.entries(a).map((function(e,t){var i=(0,u.Z)(e,2),a=i[0],s=i[1],l=s.x,d=s.y;return r().createElement("g",{key:t,transform:"translate(".concat(l*n," ").concat(d*o,")")},r().createElement("path",{d:"M0 8L8 0L0 -8L-8 0Z",strokeWidth:2,stroke:c[a].color,fill:"transparent"}))})),d.map((function(e){var t=(0,u.Z)(e,2),i=t[0],s=t[1],l=a[i],d=a[s],g=(l.x+d.x)/2,m=(l.y+d.y)/2;return r().createElement("g",{key:"".concat(l.x,",").concat(l.y,".").concat(d.x,",").concat(d.y)},r().createElement("line",{x1:l.x*n,y1:l.y*o,x2:g*n,y2:m*o,strokeWidth:2,stroke:c[i].color}),r().createElement("line",{x1:d.x*n,y1:d.y*o,x2:g*n,y2:m*o,strokeWidth:2,stroke:c[s].color}))})))},"expanding-line":(0,o.memo)((function(e){var t=e.region,n=e.iw,o=e.ih,i=t.expandingWidth,a=void 0===i?.005:i,s=t.points;a=s.slice(-1)[0].width||a;var l=s.map((function(e,t){var n=e.x,o=e.y,r=e.angle,i=e.width;if(!r){var l=s[Ne(t+1,0,s.length-1)],c=s[Ne(t-1,0,s.length-1)];r=Math.atan2(c.x-l.x,c.y-l.y)+Math.PI/2}var u=Math.sin(r)*(i||a)/2,d=Math.cos(r)*(i||a)/2;return[{x:n+u,y:o+d},{x:n-u,y:o-d}]})),c=l.map((function(e){var t=(0,u.Z)(e,2),n=t[0];return t[1],n})),d=l.map((function(e){var t=(0,u.Z)(e,2);return t[0],t[1]})).asMutable();d.reverse();var g=s.slice(-1)[0];return r().createElement(r().Fragment,null,r().createElement("polygon",{points:c.concat(t.candidatePoint?[t.candidatePoint]:[]).concat(d).map((function(e){return"".concat(e.x*n," ").concat(e.y*o)})).join(" "),strokeWidth:2,stroke:(0,Me.Z)(t.color,.75),fill:(0,Me.Z)(t.color,.25)}),s.map((function(e,i){var a=e.x,s=e.y,l=e.angle;return r().createElement("g",{key:i,transform:"translate(".concat(a*n," ").concat(s*o,") rotate(").concat(180*-(l||0)/Math.PI,")")},r().createElement("g",null,r().createElement("rect",{x:-5,y:-5,width:10,height:10,strokeWidth:2,stroke:(0,Me.Z)(t.color,.75),fill:(0,Me.Z)(t.color,.25)})))})),r().createElement("rect",{x:g.x*n-8,y:g.y*o-8,width:16,height:16,strokeWidth:4,stroke:(0,Me.Z)(t.color,.5),fill:"transparent"}))})),pixel:function(){return null}},Ae=(0,o.memo)((function(e){var t=e.regions,n=e.keypointDefinitions,o=e.iw,i=e.ih,a=e.fullSegmentationMode;return t.filter((function(e){return!1!==e.visible})).map((function(e){var t=_e[e.type];return r().createElement(t,{key:e.regionId,region:e,iw:o,ih:i,keypointDefinitions:n,fullSegmentationMode:a})}))}),(function(e,t){return e.regions===t.regions&&e.iw===t.iw&&e.ih===t.ih}));const Ce=function(e){e.mat;var t=e.imagePosition,n=e.regions,o=void 0===n?[]:n,i=e.keypointDefinitions,a=e.fullSegmentationMode,s=t.bottomRight.x-t.topLeft.x,l=t.bottomRight.y-t.topLeft.y;return isNaN(s)||isNaN(l)?null:r().createElement("svg",{width:s,height:l,style:{position:"absolute",zIndex:2,left:t.topLeft.x,top:t.topLeft.y,pointerEvents:"none",width:s,height:l}},r().createElement(Ae,{key:"wrapped-region-list",regions:o,iw:s,ih:l,keypointDefinitions:i,fullSegmentationMode:a}))};var Re=(0,E.Z)({canvas:{width:"100%",height:"100%",position:"relative",zIndex:1},zoomIndicator:{position:"absolute",bottom:16,right:0,backgroundColor:"rgba(0,0,0,0.4)",color:"#fff",opacity:.5,fontWeight:"bolder",fontSize:14,padding:4},fixedRegionLabel:{position:"absolute",zIndex:10,top:10,left:10,opacity:.5,transition:"opacity 500ms","&:hover":{opacity:1}}}),Le=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.iw,o=t.ih,r=w.y.from(1,0,0,1,-10,-10);return e&&n&&(r=r.translate(e.x*n,e.y*o).scaleU(e.w+.05)),r};const De=function(e){var t=e.regions,n=e.imageSrc,i=e.videoSrc,a=e.videoTime,s=e.realSize,l=e.showTags,d=e.onMouseMove,g=void 0===d?function(e){return null}:d,m=e.onMouseDown,f=void 0===m?function(e){return null}:m,h=e.onMouseUp,p=void 0===h?function(e){return null}:h,v=e.dragWithPrimary,E=void 0!==v&&v,b=e.zoomWithPrimary,I=void 0!==b&&b,T=e.createWithPrimary,N=void 0!==T&&T,A=e.pointDistancePrecision,C=void 0===A?0:A,R=e.regionClsList,L=e.regionTagList,D=e.showCrosshairs,P=e.showHighlightBox,j=void 0===P||P,z=e.showPointDistances,B=e.allowedArea,W=e.RegionEditLabel,G=void 0===W?null:W,H=e.videoPlaying,V=void 0!==H&&H,U=e.showMask,F=void 0===U||U,K=e.fullImageSegmentationMode,q=e.autoSegmentationOptions,J=e.onImageOrVideoLoaded,$=e.onChangeRegion,Q=e.onBeginRegionEdit,ee=e.onCloseRegionEdit,te=e.onBeginBoxTransform,ne=e.onBeginMovePolygonPoint,oe=e.onAddPolygonPoint,re=e.onBeginMoveKeypoint,ie=e.onSelectRegion,ae=e.onBeginMovePoint,se=e.onDeleteRegion,le=e.onChangeVideoTime,ce=e.onChangeVideoPlaying,ue=e.onRegionClassAdded,de=e.zoomOnAllowedArea,ge=void 0===de||de,fe=e.modifyingAllowedArea,he=void 0!==fe&&fe,pe=e.keypointDefinitions,ye=Re(),ve=(0,o.useRef)(null),Ee=(0,o.useRef)({}),we=(0,O.Z)(!1),xe=(0,u.Z)(we,2),Ze=xe[0],Te=xe[1],ke=(0,O.Z)(0),Oe=(0,u.Z)(ke,2),Me=(Oe[0],Oe[1],(0,O.Z)(null)),Ne=(0,u.Z)(Me,2),_e=Ne[0],Ae=Ne[1],De=(0,O.Z)(null),Pe=(0,u.Z)(De,2),je=Pe[0],ze=Pe[1],Be=(0,O.Z)(Le()),We=(0,u.Z)(Be,2),Ge=We[0],He=We[1],Ve=((0,o.useRef)({}),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n="undefined"!=typeof window,r=(0,O.Z)({width:n?window.innerWidth:e,height:n?window.innerHeight:t}),i=(0,u.Z)(r,2),a=i[0],s=i[1];return(0,o.useEffect)((function(){if(n){var e=function(){s({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}}),[]),(0,S.Z)((function(){n&&(window.innerWidth===a.width&&window.innerHeight===a.height||s({width:window.innerWidth,height:window.innerHeight}))}),100),a}());!function(e){var t=e.getLatestMat,n=e.changeMat,r=Ie().wasdMode;(0,o.useEffect)((function(){if(r){var e={w:[0,-10],a:[-10,0],s:[0,10],d:[10,0]},o={},i=Object.keys(e),a=function(e){i.includes(e.key)&&(o[e.key]=!0,e.preventDefault(),e.stopPropagation())},s=function(e){i.includes(e.key)&&(o[e.key]=!1,e.preventDefault(),e.stopPropagation())},l=setInterval((function(){var r=t().clone(),i=!1;for(var a in o){var s;o[a]&&(r=(s=r).translate.apply(s,(0,c.Z)(e[a])),i=!0)}i&&n(r)}),16);return window.addEventListener("keydown",a),window.addEventListener("keyup",s),function(){clearInterval(l),window.removeEventListener("keydown",a),window.removeEventListener("keyup",s)}}}),[r])}({getLatestMat:(0,Z.Z)((function(){return Ge})),changeMat:He});var Ue=function(e){var t=e.canvasEl,n=e.changeMat,r=e.changeDragging,i=e.zoomStart,a=(e.zoomEnd,e.changeZoomStart),s=e.changeZoomEnd,l=e.layoutParams,c=e.zoomWithPrimary,u=e.dragWithPrimary,d=e.mat,g=e.onMouseMove,m=e.onMouseUp,f=e.onMouseDown,h=e.dragging,p=(0,o.useRef)({x:0,y:0}),y=(0,o.useRef)({x:0,y:0}),v=function(e,t){var o=[t.x,t.y],r=o[0],i=o[1],a="object"===(0,M.Z)(e)?e.to/d.a:1+.2*e;d.translate(r,i).scaleU(a),d.a>2&&d.scaleU(2/d.a),d.a<.05&&d.scaleU(.05/d.a),d.translate(-r,-i),n(d.clone())};return{mouseEvents:{onMouseMove:function(e){var o=t.current.getBoundingClientRect(),r=o.left,a=o.top;y.current.x=p.current.x,y.current.y=p.current.y,p.current.x=e.clientX-r,p.current.y=e.clientY-a;var u=d.applyToPoint(p.current.x,p.current.y);c&&i&&s(u);var m=l.current,f=m.iw,v=m.ih;g({x:u.x/f,y:u.y/v}),h&&(d.translate(y.current.x-p.current.x,y.current.y-p.current.y),n(d.clone())),e.preventDefault()},onMouseDown:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.preventDefault(),1===e.button||2===e.button||0===e.button&&u)return r(!0);var n=d.applyToPoint(p.current.x,p.current.y);if(c&&0===e.button)return a(n),void s(n);if(0===e.button){t.type,t.type;var o=l.current,i=o.iw,g=o.ih;f({x:n.x/i,y:n.y/g})}},onMouseUp:function(e){e.preventDefault();var t=d.applyToPoint(p.current.x,p.current.y);if(i){var o=t;if(Math.abs(i.x-o.x)<10&&Math.abs(i.y-o.y)<10)d.a<1?v({to:1},p.current):v({to:.25},p.current);else{var c=l.current,g=c.iw,f=c.ih;if(i.x>o.x){var h=[o.x,i.x];i.x=h[0],o.x=h[1]}if(i.y>o.y){var y=[o.y,i.y];i.y=y[0],o.y=y[1]}var E=Math.min((o.x-i.x)/g,(o.y-i.y)/f);E<.05&&(E=.05),E>10&&(E=10);var b=w.y.from(1,0,0,1,-10,-10).translate(i.x,i.y).scaleU(E);n(b.clone())}a(null),s(null)}if(1===e.button||2===e.button||0===e.button&&u)return r(!1);if(0===e.button){var x=l.current,I=x.iw,Z=x.ih;m({x:t.x/I,y:t.y/Z})}},onWheel:function(e){var t=e.deltaY>0?1:e.deltaY<0?-1:0;v(t,p.current)},onContextMenu:function(e){e.preventDefault()}},mousePosition:p}}({canvasEl:ve,dragging:Ze,mat:Ge,layoutParams:Ee,changeMat:He,zoomStart:_e,zoomEnd:je,changeZoomStart:Ae,changeZoomEnd:ze,changeDragging:Te,zoomWithPrimary:I,dragWithPrimary:E,onMouseMove:g,onMouseDown:f,onMouseUp:p}),Fe=Ue.mouseEvents,Ye=Ue.mousePosition;(0,o.useLayoutEffect)((function(){return He(Ge.clone())}),[Ve]),Ge.applyToPoint(Ye.current.x,Ye.current.y);var Ke=function(e){var t=e.layoutParams,n=e.mat;return(0,Z.Z)((function(e){var o=t.current,r=o.iw,i=o.ih,a=function(e){switch(e.type){case"polygon":var t={x:Math.min.apply(Math,(0,c.Z)(e.points.map((function(e){var t=(0,u.Z)(e,2),n=t[0];return t[1],n})))),y:Math.min.apply(Math,(0,c.Z)(e.points.map((function(e){var t=(0,u.Z)(e,2);return t[0],t[1]})))),w:0,h:0};return t.w=Math.max.apply(Math,(0,c.Z)(e.points.map((function(e){var t=(0,u.Z)(e,2),n=t[0];return t[1],n}))))-t.x,t.h=Math.max.apply(Math,(0,c.Z)(e.points.map((function(e){var t=(0,u.Z)(e,2);return t[0],t[1]}))))-t.y,t;case"keypoints":var n=Math.min.apply(Math,(0,c.Z)(Object.values(e.points).map((function(e){var t=e.x;return e.y,t})))),o=Math.min.apply(Math,(0,c.Z)(Object.values(e.points).map((function(e){return e.x,e.y}))));return{x:n,y:o,w:Math.max.apply(Math,(0,c.Z)(Object.values(e.points).map((function(e){var t=e.x;return e.y,t}))))-n,h:Math.max.apply(Math,(0,c.Z)(Object.values(e.points).map((function(e){return e.x,e.y}))))-o};case"expanding-line":var r={x:Math.min.apply(Math,(0,c.Z)(e.points.map((function(e){var t=e.x;return e.y,t})))),y:Math.min.apply(Math,(0,c.Z)(e.points.map((function(e){return e.x,e.y})))),w:0,h:0};return r.w=Math.max.apply(Math,(0,c.Z)(e.points.map((function(e){var t=e.x;return e.y,t}))))-r.x,r.h=Math.max.apply(Math,(0,c.Z)(e.points.map((function(e){return e.x,e.y}))))-r.y,r;case"box":return{x:e.x,y:e.y,w:e.w,h:e.h};case"point":return{x:e.x,y:e.y,w:0,h:0};default:return{x:0,y:0,w:0,h:0}}throw new Error("unknown region")}(e),s="point"===e.type?15:2,l={x:a.x*r-s,y:a.y*i-s,w:a.w*r+2*s,h:a.h*i+2*s};return(0,y.Z)({},n.clone().inverse().applyToPoint(l.x,l.y),{w:l.w/n.a,h:l.h/n.d})}))}({layoutParams:Ee,mat:Ge}),Xe=(0,o.useState)(),qe=(0,u.Z)(Xe,2),Je=qe[0],$e=qe[1],Qe=Boolean(Je&&Je.naturalWidth),et=(0,Z.Z)((function(e){var t={naturalWidth:e.naturalWidth,naturalHeight:e.naturalHeight,duration:e.duration};J&&J(t),$e(t),setTimeout((function(){return $e(t)}),10)})),tt=function(){var e=(0,o.useRef)(null);if(null===e.current){e.current={image:new Image,pattern:null};var t=document.createElement("canvas");t.width=100,t.height=100;var n=t.getContext("2d");e.current.image.onload=function(){e.current.pattern=n.createPattern(e.current.image,"repeat")},e.current.image.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH4wMSAxY5oG+lzgAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAcSURBVAjXY/jPwPCfAQnA+TAGugLcAhhakRUAAK3lEe8m9qZhAAAAAElFTkSuQmCC"}return e.current.pattern}(),nt=ve.current;if(nt&&Qe){var ot=nt.clientWidth,rt=nt.clientHeight,it=Math.max(Je.naturalWidth/(ot-20),Je.naturalHeight/(rt-20)),at=Je.naturalWidth/it,st=Je.naturalHeight/it;Ee.current={iw:at,ih:st,fitScale:it,canvasWidth:ot,canvasHeight:rt}}(0,o.useEffect)((function(){Qe&&He(Le(ge?B:null,Ee.current))}),[Qe]),(0,o.useLayoutEffect)((function(){if(Je){var e=nt.clientWidth,t=nt.clientHeight;nt.width=e,nt.height=t;var n=nt.getContext("2d");n.save(),n.transform.apply(n,(0,c.Z)(Ge.clone().inverse().toArray()));var o=Ee.current,r=o.iw,i=o.ih;if(B){var a=B.x,s=B.y,l=B.w,u=B.h;n.save(),n.globalAlpha=1;var d=[[0,0],[r,0],[r,i],[0,i]],g=[[a*r,s*i],[a*r+l*r,s*i],[a*r+l*r,s*i+u*i],[a*r,s*i+u*i]];n.moveTo.apply(n,(0,c.Z)(d[0])),d.forEach((function(e){return n.lineTo.apply(n,(0,c.Z)(e))})),n.lineTo.apply(n,(0,c.Z)(d[0])),n.closePath(),g.reverse(),n.moveTo.apply(n,(0,c.Z)(g[0])),g.forEach((function(e){return n.lineTo.apply(n,(0,c.Z)(e))})),n.lineTo.apply(n,(0,c.Z)(g[0])),n.fillStyle=tt||"#f00",n.fill(),n.restore()}n.restore()}}));var lt=Ee.current,ct=lt.iw,ut=lt.ih,dt=_e&&je?(0,y.Z)({},Ge.clone().inverse().applyToPoint(_e.x,_e.y),{w:(je.x-_e.x)/Ge.a,h:(je.y-_e.y)/Ge.d}):null;dt&&(dt.w<0&&(dt.x+=dt.w,dt.w*=-1),dt.h<0&&(dt.y+=dt.h,dt.h*=-1));var gt={topLeft:Ge.clone().inverse().applyToPoint(0,0),bottomRight:Ge.clone().inverse().applyToPoint(ct,ut)},mt=(0,o.useMemo)((function(){var e=t.filter((function(e){return e.highlighted}));return 1!==e.length?null:e[0]}),[t]);return r().createElement("div",{style:{width:"100%",height:"100%",maxHeight:"calc(100vh - 68px)",position:"relative",overflow:"hidden",cursor:N?"crosshair":Ze?"grabbing":E?"grab":I?Ge.a<1?"zoom-out":"zoom-in":void 0}},D&&r().createElement(x,{key:"crossHairs",mousePosition:Ye}),Qe&&!Ze&&r().createElement(be,{key:"regionSelectAndTransformBoxes",regions:he&&B?[{type:"box",id:"$$allowed_area",cls:"allowed_area",highlighted:!0,x:B.x,y:B.y,w:B.w,h:B.h,visible:!0,color:"#ff0"}]:t,mouseEvents:Fe,projectRegionBox:Ke,dragWithPrimary:E,createWithPrimary:N,zoomWithPrimary:I,onBeginMovePoint:ae,onSelectRegion:ie,layoutParams:Ee,mat:Ge,onBeginBoxTransform:te,onBeginMovePolygonPoint:ne,onBeginMoveKeypoint:re,onAddPolygonPoint:oe,showHighlightBox:j}),Qe&&l&&!Ze&&r().createElement(k,{key:"regionTags"},r().createElement(X,{regions:t,projectRegionBox:Ke,mouseEvents:Fe,regionClsList:R,regionTagList:L,onBeginRegionEdit:Q,onChangeRegion:$,onCloseRegionEdit:ee,onDeleteRegion:se,layoutParams:Ee,imageSrc:n,RegionEditLabel:G,onRegionClassAdded:ue})),!l&&mt&&r().createElement("div",{key:"topLeftTag",className:ye.fixedRegionLabel},r().createElement(Y,{disableClose:!0,allowedClasses:R,allowedTags:L,onChange:$,onDelete:se,editing:!0,region:mt,imageSrc:n})),I&&null!==dt&&r().createElement("div",{key:"zoomBox",style:{position:"absolute",zIndex:1,border:"1px solid #fff",pointerEvents:"none",left:dt.x,top:dt.y,width:dt.w,height:dt.h}}),z&&r().createElement(_,{key:"pointDistances",regions:t,realSize:s,projectRegionBox:Ke,pointDistancePrecision:C}),r().createElement(k,Object.assign({style:{width:"100%",height:"100%"}},Fe),r().createElement(r().Fragment,null,K&&r().createElement(me,{hide:!F,autoSegmentationOptions:q,imagePosition:gt,regionClsList:R,imageSrc:n,regions:t}),r().createElement("canvas",{style:{opacity:.25},className:ye.canvas,ref:ve}),r().createElement(Ce,{mat:Ge,keypointDefinitions:pe,imagePosition:gt,regions:t,fullSegmentationMode:K}),r().createElement(Se,{videoPlaying:V,imagePosition:gt,mouseEvents:Fe,onLoad:et,videoTime:a,videoSrc:i,imageSrc:n,useCrossOrigin:K,onChangeVideoTime:le,onChangeVideoPlaying:ce}))),r().createElement("div",{className:ye.zoomIndicator},(1/Ge.a*100).toFixed(0),"%"))},Pe={container:{display:"flex",flexGrow:1,flexDirection:"column",height:"100%",maxHeight:"100vh",backgroundColor:"#fff",overflow:"hidden","&.fullscreen":{position:"absolute",zIndex:99999,left:0,right:0,top:0,bottom:0}},headerTitle:{fontWeight:"bold",color:C.Z[700],paddingLeft:16}};var je=n(20852),ze=n.n(je),Be=n(52663),We=n(66083),Ge=n(29525),He=n(66856),Ve=n(79788);const Ue=function(e){var t=e.open,n=e.onClose,o=Ie();return r().createElement(Be.Z,{open:t||!1,onClose:n},r().createElement(We.Z,null,"Settings"),r().createElement(Ge.Z,{style:{minWidth:400}},r().createElement(Ve.Z,{variant:"flat",noActions:!0,defaultAnswers:o,onQuestionChange:function(e,t,n){return o.changeSetting(e,t)},form:{questions:[{type:"boolean",title:"Show Crosshairs",name:"showCrosshairs"},{type:"boolean",title:"Show Highlight Box",name:"showHighlightBox"},{type:"boolean",title:"WASD Mode",name:"wasdMode"},{type:"dropdown",title:"Video Playback Speed",name:"videoPlaybackSpeed",defaultValue:"1x",choices:["0.25x","0.5x","1x","2x"]}]}})),r().createElement(He.Z,null,r().createElement(j.Z,{onClick:n},"Close")))};var Fe=n(53110);const Ye=function(e){var t,n,o=null;return"image"===e.annotationType?-1===(o=e.selectedImage)?(o=null,n=null):(t=["images",o],n=(0,H.getIn)(e,t)):"video"===e.annotationType&&(t=["keyframes",e.currentVideoTime||0],n=(0,H.getIn)(e,t)||null),{currentImageIndex:o,pathToActiveImage:t,activeImage:n}};function Ke(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Xe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Xe(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function Xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var qe=[];const Je=function(e,t){if(e[t||0])return e[t||0].regions;var n=Object.keys(e).map((function(e){return parseInt(e)})).filter((function(e){return!isNaN(e)}));if(0===n.length)return qe;n.sort((function(e,t){return e-t}));var o=n.findIndex((function(e){return e>=t}));if(-1===o)return e[n[n.length-1]].regions||qe;if(0===o)return qe;var r,i=n[o-1],a=e[i],s=n[o],l=e[s],c={},d={},g=Ke(a.regions);try{for(g.s();!(r=g.n()).done;){var m=r.value;c[m.id]=m}}catch(e){g.e(e)}finally{g.f()}var f,h=Ke(l.regions);try{for(h.s();!(f=h.n()).done;){var p=f.value;d[p.id]=p}}catch(e){h.e(e)}finally{h.f()}var v=[],E=(s-t)/(s-i),b=1-E,w=function(e){var t=[c[e],d[e]],n=t[0],o=t[1];if(!o)return v.push((0,y.Z)({},n,{highlighted:!1,editingLabels:!1})),"continue";switch(n.type){case"point":v.push((0,y.Z)({},n,{highlighted:!1,editingLabels:!1,x:n.x*E+o.x*b,y:n.y*E+o.y*b}));break;case"box":v.push((0,y.Z)({},n,{highlighted:!1,editingLabels:!1,x:n.x*E+o.x*b,y:n.y*E+o.y*b,w:n.w*E+o.w*b,h:n.h*E+o.h*b}));break;case"polygon":o.points.length===n.points.length?v.push((0,y.Z)({},n,{highlighted:!1,editingLabels:!1,points:n.points.map((function(e,t){return[e[0]*E+o.points[t][0]*b,e[1]*E+o.points[t][1]*b]}))})):v.push(n);break;case"keypoints":for(var r={},i=0,a=Object.entries(n.points);i<a.length;i++){var s=a[i],l=(0,u.Z)(s,2),g=l[0],m=l[1];r[g]={x:m.x*E+o.points[g].x*b,y:m.y*E+o.points[g].y*b}}v.push((0,y.Z)({},n,{highlighted:!1,editingLabels:!1,points:r}))}};for(var x in c)w(x);return v};for(var $e=[],Qe=n(63274),et={},tt=0,nt=[{id:"select_tool",description:"Switch to the Select Tool",binding:"escape"},{id:"zoom_tool",description:"Select the Zoom Tool",binding:"z"},{id:"create_point",description:"Create a point"},{id:"create_bounding_box",description:"Create a bounding box",binding:"b"},{id:"pan_tool",description:"Select the Pan Tool",binding:"m"},{id:"create_polygon",description:"Create a Polygon",binding:"p"},{id:"create_pixel",description:"Create a Pixel Mask"},{id:"save_and_previous_sample",description:"Save and go to previous sample",binding:"ArrowLeft"},{id:"save_and_next_sample",description:"Save and go to next sample",binding:"ArrowRight"},{id:"save_and_exit_sample",description:"Save and exit current sample"},{id:"exit_sample",description:"Exit sample without saving"},{id:"delete_region",description:"Delete selected region",binding:"d"},{id:"undo",description:"Undo latest change",binding:"Ctrl+z"}];tt<nt.length;tt++){var ot=nt[tt],rt=ot.id,it=ot.binding;et[rt]=it}var at=n(17625),st=n(51436),lt=n(57118),ct=n(26498),ut={marginTop:4,width:16,height:16,marginBottom:4};const dt={select:function(){return r().createElement(at.G,{style:ut,size:"xs",fixedWidth:!0,icon:st.kwz})},pan:function(){return r().createElement(at.G,{style:ut,size:"xs",fixedWidth:!0,icon:st.R3t})},zoom:function(){return r().createElement(at.G,{style:ut,size:"xs",fixedWidth:!0,icon:st.wn1})},"show-tags":function(){return r().createElement(at.G,{style:ut,size:"xs",fixedWidth:!0,icon:st.LEN})},"create-point":function(){return r().createElement(at.G,{style:ut,size:"xs",fixedWidth:!0,icon:st.KS0})},"create-box":function(){return r().createElement(at.G,{style:ut,size:"xs",fixedWidth:!0,icon:st._mi})},"create-polygon":function(){return r().createElement(at.G,{style:ut,size:"xs",fixedWidth:!0,icon:st.ubJ})},"create-expanding-line":function(){return r().createElement(at.G,{style:ut,size:"xs",fixedWidth:!0,icon:st.hx$})},"show-mask":function(){return r().createElement(at.G,{style:ut,size:"xs",fixedWidth:!0,icon:st.P2X})},"modify-allowed-area":function(){return r().createElement(at.G,{style:ut,size:"xs",fixedWidth:!0,icon:st.Xcf})},"create-keypoints":ct.Z,window:lt.Z};var gt=n(96026),mt=n.n(gt),ft=n(73460);const ht=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(e<1e3)return e+"ms";var n=e/1e3;if(n<60)return Number.isInteger(n)?n+"s":n.toFixed(t)+"s";var o=n/60;return Number.isInteger(o)?o+"m":o.toFixed(t)+"m"};var pt;function yt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var vt=(0,b.Z)("div")({position:"relative",display:"flex",flexGrow:1,minWidth:240,height:64,marginLeft:16,marginRight:16}),Et=(0,b.Z)("div")({position:"absolute",width:2,marginLeft:-1,height:"100%",backgroundColor:C.Z[300],bottom:0}),bt=(0,b.Z)("div")({position:"absolute",userSelect:"none",fontSize:10,color:C.Z[600],fontWeight:"bold",bottom:0}),wt=(0,b.Z)("div")({position:"absolute",bottom:"calc(50% + 6px)",fontSize:10,fontWeight:"bold",color:"#fff",display:"grid",placeItems:"center",width:48,marginLeft:-24,borderRadius:2,height:24,backgroundColor:J.Z[500],userSelect:"none",fontVariantNumeric:"tabular-nums","&::before":{position:"absolute",bottom:-6,left:16,content:'""',width:0,height:0,borderTop:"8px solid ".concat(J.Z[500]),borderLeft:"8px solid transparent",borderRight:"8px solid transparent"}}),xt=(0,b.Z)("div")((pt={position:"absolute",bottom:8,cursor:"pointer",opacity:.75,fontSize:10,fontWeight:"bold",color:"#fff",display:"grid",placeItems:"center",width:16,marginLeft:0,borderTopLeftRadius:2,borderTopRightRadius:2,height:12},(0,s.Z)(pt,"marginLeft",-8),(0,s.Z)(pt,"backgroundColor",q.Z[500]),(0,s.Z)(pt,"userSelect","none"),(0,s.Z)(pt,"fontVariantNumeric","tabular-nums"),(0,s.Z)(pt,"&::before",{position:"absolute",bottom:-8,left:0,content:'""',width:0,height:0,borderTop:"8px solid ".concat(q.Z[500]),borderLeft:"8px solid transparent",borderRight:"8px solid transparent"}),pt)),It=6e4,Zt=[[50,250],[100,500],[250,1e3],[1e3,5e3],[5e3,3e4],[1e4,It],[3e4,2*It],[It,5*It],[5*It,30*It],[6e5,60*It],[30*It,108e5],[60*It,18e6]];const Tt=function(e){var t=e.currentTime,n=void 0===t?0:t,i=e.duration,a=e.onChangeCurrentTime,s=e.keyframes,l=(0,ft.Z)(),c=(0,u.Z)(l,2),d=c[0],g=c[1],m=(0,o.useState)(n),f=(0,u.Z)(m,2),h=f[0],p=f[1],y=(0,O.Z)(!1),v=(0,u.Z)(y,2),E=v[0],b=v[1],w=Object.keys(s||{}).map((function(e){return parseInt(e)})).filter((function(e){return!isNaN(e)})).sort((function(e,t){return e-t}));(0,o.useEffect)((function(){n!==h&&p(n)}),[n]);var x=(0,o.useMemo)((function(){return function(e){var t,n=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return yt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?yt(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}(Zt);try{for(n.s();!(t=n.n()).done;){var o=t.value,r=(0,u.Z)(o,2),i=r[0],a=r[1];if(e/a<6&&e/a>2)return[i,a]}}catch(e){n.e(e)}finally{n.f()}return[e/4,e]}(i)}),[i]),I=(0,u.Z)(x,2),T=I[0],k=I[1],S=(0,Z.Z)((function(e){if(E){var t=(e.clientX-g.left)/g.width;p(Math.min(i,Math.max(0,Math.floor(t*i))))}})),M=(0,Z.Z)((function(e){b(!1);var t=(e.clientX-g.left)/g.width,n=Math.min(i,Math.max(0,Math.floor(t*i)));p(n),a(n)}));return i?r().createElement(vt,{onMouseMove:S,onMouseUp:M,ref:d},mt()(0,i,k).map((function(e){return r().createElement(r().Fragment,null,r().createElement(Et,{key:e,style:{left:e/i*g.width,height:"50%"}}),r().createElement(bt,{style:{left:e/i*g.width+8,bottom:"calc(50% - 12px)"}},ht(e)))})),mt()(0,i,T).filter((function(e){return!Number.isInteger(e/k)})).map((function(e){return r().createElement(Et,{key:e,style:{left:e/i*g.width,height:"25%"}})})),w.map((function(e){return r().createElement(xt,{onClick:function(){return a(e)},key:e,style:{left:e/i*g.width}})})),r().createElement(wt,{onMouseDown:function(e){return b(!0)},style:{cursor:E?"grabbing":"grab",left:h/i*g.width}},ht(h))):null};var kt=n(97045),Ot=n(64573),St=(0,E.Z)({container:{margin:8},header:{display:"flex",flexDirection:"row",alignItems:"center",padding:8,paddingLeft:16,paddingRight:16},title:{fontSize:14,fontWeight:"bold",flexGrow:1,paddingLeft:8,color:C.Z[800],"& span":{color:C.Z[600],fontSize:12}},expandButton:{padding:0,width:30,height:30,"& .icon":{marginTop:-6,width:20,height:20,transition:"500ms transform","&.expanded":{transform:"rotate(180deg)"}}},expandedContent:{maxHeight:300,overflowY:"auto","&.noScroll":{overflowY:"visible",overflow:"visible"}}}),Mt=function(e){var t=e.icon,n=e.title,i=(e.subTitle,e.children),a=e.noScroll,s=void 0!==a&&a,l=e.expandedByDefault,c=void 0!==l&&l,d=St(),g=(D()(d.expandedContent,s&&"noScroll"),(0,o.useState)(c)),m=(0,u.Z)(g,2),f=m[0],h=m[1];return(0,Z.Z)((function(){return h(!f)})),r().createElement(Ot.Z,{icon:t,title:n},i)};const Nt=(0,o.memo)(Mt,(function(e,t){return e.title===t.title&&e.children===t.children})),_t=function(e){var t=e.state,n=e.lastAction,o=(t.images||[])[t.selectedImage],i=o?(o.regions||[]).filter((function(e){return e.highlighted})):null;return r().createElement(Nt,{title:"Debug",icon:r().createElement("span",null),expandedByDefault:!0},r().createElement("div",{style:{padding:4}},r().createElement("div",null,r().createElement("b",null,"region"),":"),r().createElement("pre",null,JSON.stringify(i,null,"  ")),r().createElement("div",null,r().createElement("b",null,"lastAction"),":"),r().createElement("pre",null,JSON.stringify(n,null,"  ")),r().createElement("div",null,r().createElement("b",null,"mode"),":"),r().createElement("pre",null,JSON.stringify(t.mode,null,"  ")),r().createElement("div",null,r().createElement("b",null,"frame:")),r().createElement("pre",null,JSON.stringify(t.selectedImageFrameTime,null,"  "))))};var At=n(33320),Ct=((0,E.Z)({}),[]),Rt=function(){return null},Lt=function(e){var t=e.currentImage,n=e.imageClsList,i=void 0===n?Ct:n,a=e.imageTagList,s=void 0===a?Ct:a,l=e.onChangeImage,c=void 0===l?Rt:l,u=t||{},d=u.tags,g=void 0===d?[]:d,m=u.cls,f=void 0===m?null:m,h=(0,Z.Z)((function(e){return c({cls:e.value})})),p=(0,Z.Z)((function(e){return c({tags:e.map((function(e){return e.value}))})})),y=(0,o.useMemo)((function(){return f?{value:f,label:f}:null}),[f]),v=(0,o.useMemo)((function(){return(0,H.asMutable)(i.map((function(e){return{value:e,label:e}})))}),[i]),E=(0,o.useMemo)((function(){return(0,H.asMutable)(s.map((function(e){return{value:e,label:e}})))}),[s]),b=(0,o.useMemo)((function(){return g.map((function(e){return{value:e,label:e}}))}),[g]);return t?r().createElement(Nt,{title:"Image Tags",expandedByDefault:!0,noScroll:!0,icon:r().createElement(At.Z,{style:{color:C.Z[700]}})},i.length>0&&r().createElement("div",{style:{padding:8}},r().createElement(W.default,{placeholder:"Image Classification",onChange:h,value:y,options:v})),s.length>0&&r().createElement("div",{style:{padding:8,paddingTop:0}},r().createElement(W.default,{isMulti:!0,placeholder:"Image Tags",onChange:p,value:b,options:E}))):null};const Dt=(0,o.memo)(Lt,(function(e,t){return e.currentImage.cls===t.currentImage.cls&&e.currentImage.tags===t.currentImage.tags&&e.imageClsList===t.imageClsList&&e.imageTagList===t.imageTagList}));var Pt=n(29918),jt=(0,b.Z)("div")({cursor:"pointer",display:"flex",alignItems:"center",padding:8,fontSize:14,color:C.Z[700],"&.current":{backgroundColor:J.Z[100]},"&:hover":{backgroundColor:C.Z[100]},"& .time":{flexGrow:1,fontWeight:"bold","& .regionCount":{marginLeft:8,fontWeight:"normal",color:C.Z[500]}},"& .trash":{"& .icon":{fontSize:18,color:C.Z[600],transition:"transform 80ms","&:hover":{color:C.Z[800],transform:"scale(1.25,1.25)"}}}});const zt=function(e){var t=e.currentVideoTime,n=e.keyframes,o=e.onChangeVideoTime,i=e.onDeleteKeyframe,a=Object.keys(n).map((function(e){return parseInt(e)}));return r().createElement(Nt,{title:"Keyframes",subTitle:"",icon:r().createElement(Pt.Z,{style:{color:C.Z[700]}}),expandedByDefault:!0},a.map((function(e){var a;return r().createElement(jt,{fullWidth:!0,key:e,className:t===e?"current":"",onClick:function(){return o(e)}},r().createElement("div",{className:"time"},ht(e,2),r().createElement("span",{className:"regionCount"},"(",((null===(a=n[e])||void 0===a?void 0:a.regions)||[]).length,")")),r().createElement("div",{className:"trash"},r().createElement(z.default,{onClick:function(t){i(e),t.stopPropagation()},className:"icon"})))})))};var Bt=n(67879),Wt=n(30724),Gt=n.n(Wt),Ht=(0,b.Z)("div")({paddingLeft:16,paddingRight:16,fontSize:12,"& h1":{fontSize:18},"& h2":{fontSize:14},"& h3":{fontSize:12},"& h4":{fontSize:12},"& h5":{fontSize:12},"& h6":{fontSize:12},"& p":{fontSize:12},"& a":{},"& img":{width:"100%"}}),Vt=function(e){var t=e.description;return r().createElement(Nt,{title:"Task Description",icon:r().createElement(Bt.Z,{style:{color:C.Z[700]}}),expandedByDefault:!t||""===t},r().createElement(Ht,null,r().createElement(Gt(),{source:t})))};const Ut=(0,o.memo)(Vt);var Ft=n(20625),Yt=n(41749),Kt=n(90482),Xt=n(24799),qt=n(77315),Jt=n(20067),$t=n(28270);const Qt={container:{fontSize:11,fontWeight:"bold",color:C.Z[700],"& .icon":{marginTop:4,width:16,height:16},"& .icon2":{opacity:.5,width:16,height:16,transition:"200ms opacity","&:hover":{cursor:"pointer",opacity:1}}},row:{padding:4,cursor:"pointer","&.header:hover":{backgroundColor:"#fff"},"&.highlighted":{backgroundColor:J.Z[100]},"&:hover":{backgroundColor:J.Z[50],color:C.Z[800]}},chip:{display:"flex",flexDirection:"row",padding:2,borderRadius:2,paddingLeft:4,paddingRight:4,alignItems:"center","& .color":{borderRadius:5,width:10,height:10,marginRight:4},"& .text":{}}};var en=n(18446),tn=n.n(en),nn=(0,E.Z)(Qt),on=(0,b.Z)("div")({borderTop:"1px solid ".concat(C.Z[200]),marginTop:2,marginBottom:2}),rn=function(e){var t=e.color,n=e.text,o=nn();return r().createElement("span",{className:o.chip},r().createElement("div",{className:"color",style:{backgroundColor:t}}),r().createElement("div",{className:"text"},n))},an=function(e){var t=e.header,n=e.highlighted,i=e.order,a=e.classification,s=e.area,l=(e.tags,e.trash),c=e.lock,d=e.visible,g=e.onClick,m=nn(),f=(0,o.useState)(!1),h=(0,u.Z)(f,2),p=(h[0],h[1]);return r().createElement("div",{onClick:g,onMouseEnter:function(){return p(!0)},onMouseLeave:function(){return p(!1)},className:D()(m.row,{header:t,highlighted:n})},r().createElement(Yt.Z,{container:!0,alignItems:"center"},r().createElement(Yt.Z,{item:!0,xs:2},r().createElement("div",{style:{textAlign:"right",paddingRight:10}},i)),r().createElement(Yt.Z,{item:!0,xs:5},a),r().createElement(Yt.Z,{item:!0,xs:2},r().createElement("div",{style:{textAlign:"right",paddingRight:6}},s)),r().createElement(Yt.Z,{item:!0,xs:1},l),r().createElement(Yt.Z,{item:!0,xs:1},c),r().createElement(Yt.Z,{item:!0,xs:1},d)))},sn=function(){return r().createElement(an,{header:!0,highlighted:!1,order:r().createElement(Kt.Z,{className:"icon"}),classification:r().createElement("div",{style:{paddingLeft:10}},"Class"),area:r().createElement(Xt.Z,{className:"icon"}),trash:r().createElement(z.default,{className:"icon"}),lock:r().createElement(K.Z,{className:"icon"}),visible:r().createElement(Jt.Z,{className:"icon"})})},ln=(0,o.memo)(sn),cn=function(e){var t=e.region,n=e.highlighted,o=e.onSelectRegion,i=e.onDeleteRegion,a=e.onChangeRegion,s=(e.visible,e.locked,e.color),l=e.cls,c=e.index;return r().createElement(an,{header:!1,highlighted:n,onClick:function(){return o(t)},order:"#".concat(c+1),classification:r().createElement(rn,{text:l||"",color:s||"#ddd"}),area:"",trash:r().createElement(z.default,{onClick:function(){return i(t)},className:"icon2"}),lock:t.locked?r().createElement(K.Z,{onClick:function(){return a((0,y.Z)({},t,{locked:!1}))},className:"icon2"}):r().createElement(qt.Z,{onClick:function(){return a((0,y.Z)({},t,{locked:!0}))},className:"icon2"}),visible:t.visible||void 0===t.visible?r().createElement(Jt.Z,{onClick:function(){return a((0,y.Z)({},t,{visible:!1}))},className:"icon2"}):r().createElement($t.Z,{onClick:function(){return a((0,y.Z)({},t,{visible:!0}))},className:"icon2"})})},un=(0,o.memo)(cn,(function(e,t){return e.highlighted===t.highlighted&&e.visible===t.visible&&e.locked===t.locked&&e.id===t.id&&e.index===t.index&&e.cls===t.cls&&e.color===t.color})),dn=[],gn=function(e){var t=e.regions,n=void 0===t?dn:t,o=e.onDeleteRegion,i=e.onChangeRegion,a=e.onSelectRegion,s=nn();return r().createElement(Nt,{title:"Regions",subTitle:"",icon:r().createElement(Ft.Z,{style:{color:C.Z[700]}}),expandedByDefault:!0},r().createElement("div",{className:s.container},r().createElement(ln,null),r().createElement(on,null),n.map((function(e,t){return r().createElement(un,Object.assign({key:e.id},e,{region:e,index:t,onSelectRegion:a,onDeleteRegion:o,onChangeRegion:i}))}))))},mn=function(e){return[e.id,e.color,e.locked,e.visible,e.highlighted]};const fn=(0,o.memo)(gn,(function(e,t){return tn()((e.regions||dn).map(mn),(t.regions||dn).map(mn))}));(0,E.Z)({img:{width:40,height:40,borderRadius:8}});var hn=n(57321),pn=n(62822),yn=n(50998),vn=n(95757),En=n(81860),bn=n(69446),wn=n(30381),xn=n.n(wn),In=(0,E.Z)({emptyText:{fontSize:14,fontWeight:"bold",color:C.Z[500],textAlign:"center",padding:20}}),Zn={paddingLeft:16},Tn=function(e){var t=e.history,n=e.onRestoreHistory,o=In();return r().createElement(Nt,{title:"History",icon:r().createElement(hn.Z,{style:{color:C.Z[700]}}),expandedByDefault:!0},r().createElement(pn.Z,null,0===t.length&&r().createElement("div",{className:o.emptyText},"No History Yet"),t.map((function(e,t){var o=e.name,i=e.time;return r().createElement(yn.Z,{button:!0,dense:!0,key:t},r().createElement(vn.Z,{style:Zn,primary:o,secondary:xn()(i).format("LT")}),0===t&&r().createElement(En.Z,{onClick:function(){return n()}},r().createElement(P.Z,null,r().createElement(bn.Z,null))))}))))};const kn=(0,o.memo)(Tn,(function(e,t){return tn()(e.history.map((function(e){return[e.name,e.time]})),t.history.map((function(e){return[e.name,e.time]})))})),On=function(e){var t,n,o,r=null===(t=(0,Qe.getApplicationKeyMap)()[e])||void 0===t||null===(n=t.sequences)||void 0===n||null===(o=n[0])||void 0===o?void 0:o.sequence;return r?" (".concat(r,")"):""};var Sn=[],Mn=(0,E.Z)(Pe),Nn=(0,Qe.withHotKeys)((function(e){var t=e.hotKeys,n=e.children,o=e.divRef,i=(0,v.Z)(e,["hotKeys","children","divRef"]);return r().createElement("div",Object.assign({},(0,y.Z)({},t,i),{ref:o}),n)})),_n=(0,b.Z)("div")({width:"100%",height:"100%","& .fullscreen":{width:"100%",height:"100%"}});const An=function(e){var t,n=e.state,i=e.dispatch,a=(e.alwaysShowNextButton,e.alwaysShowPrevButton,e.RegionEditLabel),s=e.onRegionClassAdded,l=e.hideHeader,c=e.hideHeaderText,u=e.hideNext,d=void 0!==u&&u,g=e.hidePrev,m=void 0!==g&&g,f=Mn(),h=Ie(),p=(0,Fe.r)(),v=(0,o.useRef)({}),E=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var r="".concat(e,"(").concat(n.join(","),")");if(v.current[r])return v.current[r];var a=function(){for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return n.length>0?i((0,y.Z)({type:e},n.reduce((function(e,t,n){return e[t]=o[n],e}),{}))):i((0,y.Z)({type:e},o[0]))};return v.current[r]=a,a},b=Ye(n),w=b.currentImageIndex,x=b.activeImage;null!==w&&(t=n.images[w+1]),ze()((function(){return i({type:"CANCEL"})}),{detectKeys:[27]}),x&&x.frameTime;var I=(0,o.useRef)(),T=function(e){var t=e.dispatch;return(0,o.useMemo)((function(){return{select_tool:function(){t({type:"SELECT_TOOL",selectedTool:"select"})},zoom_tool:function(){t({type:"SELECT_TOOL",selectedTool:"zoom"})},create_point:function(){t({type:"SELECT_TOOL",selectedTool:"create-point"})},create_bounding_box:function(){t({type:"SELECT_TOOL",selectedTool:"create-box"})},pan_tool:function(){t({type:"SELECT_TOOL",selectedTool:"pan"})},create_polygon:function(){t({type:"SELECT_TOOL",selectedTool:"create-polygon"})},create_pixel:function(){t({type:"SELECT_TOOL",selectedTool:"create-pixel"})},save_and_previous_sample:function(){t({type:"HEADER_BUTTON_CLICKED",buttonName:"Prev"})},save_and_next_sample:function(){t({type:"HEADER_BUTTON_CLICKED",buttonName:"Next"})},save_and_exit_sample:function(){t({type:"HEADER_BUTTON_CLICKED",buttonName:"Save"})},delete_region:function(){t({type:"DELETE_SELECTED_REGION"})},undo:function(){t({type:"RESTORE_HISTORY"})}}}),[t])}({dispatch:i}),k=function(e){if("video"!==e.annotationType)return $e;var t=e.keyframes,n=e.currentVideoTime,r=void 0===n?0:n;return(0,o.useMemo)((function(){return Je(t,r)}),[t,r])}(n),O=(0,o.useCallback)((function(e){I.current&&(I.current.contains(document.activeElement)||I.current.contains(e.target)&&(I.current.focus(),e.target.focus()))}),[]),S=r().createElement(De,Object.assign({},h,{showCrosshairs:h.showCrosshairs&&!["select","pan","zoom"].includes(n.selectedTool),key:n.selectedImage,showMask:n.showMask,fullImageSegmentationMode:n.fullImageSegmentationMode,autoSegmentationOptions:n.autoSegmentationOptions,showTags:n.showTags,allowedArea:n.allowedArea,modifyingAllowedArea:"modify-allowed-area"===n.selectedTool,regionClsList:n.regionClsList,regionTagList:n.regionTagList,regions:"image"===n.annotationType?x.regions||[]:k,realSize:x?x.realSize:void 0,videoPlaying:n.videoPlaying,imageSrc:"image"===n.annotationType?x.src:null,videoSrc:"video"===n.annotationType?n.videoSrc:null,pointDistancePrecision:n.pointDistancePrecision,createWithPrimary:n.selectedTool.includes("create"),dragWithPrimary:"pan"===n.selectedTool,zoomWithPrimary:"zoom"===n.selectedTool,showPointDistances:n.showPointDistances,videoTime:"image"===n.annotationType?n.selectedImageFrameTime:n.currentVideoTime,keypointDefinitions:n.keypointDefinitions,onMouseMove:E("MOUSE_MOVE"),onMouseDown:E("MOUSE_DOWN"),onMouseUp:E("MOUSE_UP"),onChangeRegion:E("CHANGE_REGION","region"),onBeginRegionEdit:E("OPEN_REGION_EDITOR","region"),onCloseRegionEdit:E("CLOSE_REGION_EDITOR","region"),onDeleteRegion:function(t){e.onDeleteRegion&&e.onDeleteRegion(t),E("DELETE_REGION","region")},onBeginBoxTransform:E("BEGIN_BOX_TRANSFORM","box","directions"),onBeginMovePolygonPoint:E("BEGIN_MOVE_POLYGON_POINT","polygon","pointIndex"),onBeginMoveKeypoint:E("BEGIN_MOVE_KEYPOINT","region","keypointId"),onAddPolygonPoint:E("ADD_POLYGON_POINT","polygon","point","pointIndex"),onSelectRegion:function(t){e.onSelectRegion&&e.onSelectRegion(t),E("SELECT_REGION","region")},onBeginMovePoint:E("BEGIN_MOVE_POINT","point"),onImageLoaded:E("IMAGE_LOADED","image"),RegionEditLabel:a,onImageOrVideoLoaded:E("IMAGE_OR_VIDEO_LOADED","metadata"),onChangeVideoTime:E("CHANGE_VIDEO_TIME","newTime"),onChangeVideoPlaying:E("CHANGE_VIDEO_PLAYING","isPlaying"),onRegionClassAdded:s})),M=(0,Z.Z)((function(e){i({type:"SELECT_TOOL",selectedTool:e.name})})),N=(0,Z.Z)((function(e){"Fullscreen"===e.name?p.enter():"Window"===e.name&&p.exit(),i({type:"HEADER_BUTTON_CLICKED",buttonName:e.name})})),_=Boolean(window.localStorage.$ANNOTATE_DEBUG_MODE&&n),A=!t||t.regions&&t.regions.length>0;return r().createElement(_n,null,r().createElement(Fe.I,{handle:p,onChange:function(e){e||(p.exit(),E("HEADER_BUTTON_CLICKED","buttonName")("Window"))}},r().createElement(Nn,{tabIndex:-1,divRef:I,onMouseDown:O,onMouseOver:O,allowChanges:!0,handlers:T,className:D()(f.container,n.fullScreen&&"Fullscreen")},r().createElement(kt.Z,{allowFullscreen:!0,iconDictionary:dt,hideHeader:l,hideHeaderText:c,headerLeftSide:["video"===n.annotationType?r().createElement(Tt,{currentTime:n.currentVideoTime,duration:n.videoDuration,onChangeCurrentTime:E("CHANGE_VIDEO_TIME","newTime"),keyframes:n.keyframes}):x?r().createElement("div",{className:f.headerTitle},x.name):null].filter(Boolean),headerItems:[!m&&{name:"Prev"},!d&&{name:"Next"},"video"!==n.annotationType?null:n.videoPlaying?{name:"Pause"}:{name:"Play"},!A&&x.regions&&{name:"Clone"},{name:"Settings"},n.fullScreen?{name:"Window"}:{name:"Fullscreen"},{name:"Save"}].filter(Boolean),onClickHeaderItem:N,onClickIconSidebarItem:M,selectedTools:[n.selectedTool,n.showTags&&"show-tags",n.showMask&&"show-mask"].filter(Boolean),iconSidebarItems:[{name:"select",helperText:"Select"+On("select_tool"),alwaysShowing:!0},{name:"pan",helperText:"Drag/Pan (right or middle click)"+On("pan_tool"),alwaysShowing:!0},{name:"zoom",helperText:"Zoom In/Out (scroll)"+On("zoom_tool"),alwaysShowing:!0},{name:"show-tags",helperText:"Show / Hide Tags",alwaysShowing:!0},{name:"create-point",helperText:"Add Point"+On("create_point")},{name:"create-box",helperText:"Add Bounding Box"+On("create_bounding_box")},{name:"create-polygon",helperText:"Add Polygon"+On("create_polygon")},{name:"create-expanding-line",helperText:"Add Expanding Line"},{name:"create-keypoints",helperText:"Add Keypoints (Pose)"},n.fullImageSegmentationMode&&{name:"show-mask",alwaysShowing:!0,helperText:"Show / Hide Mask"},{name:"modify-allowed-area",helperText:"Modify Allowed Area"}].filter(Boolean).filter((function(e){return e.alwaysShowing||n.enabledTools.includes(e.name)})),rightSidebarItems:[_&&r().createElement(_t,{state:_,lastAction:n.lastAction}),n.taskDescription&&r().createElement(Ut,{description:n.taskDescription}),n.labelImages&&r().createElement(Dt,{currentImage:x,imageClsList:n.imageClsList,imageTagList:n.imageTagList,onChangeImage:E("CHANGE_IMAGE","delta"),expandedByDefault:!0}),r().createElement(fn,{regions:x?x.regions:Sn,onSelectRegion:E("SELECT_REGION","region"),onDeleteRegion:E("DELETE_REGION","region"),onChangeRegion:E("CHANGE_REGION","region")}),n.keyframes&&r().createElement(zt,{onChangeVideoTime:E("CHANGE_VIDEO_TIME","newTime"),onDeleteKeyframe:E("DELETE_KEYFRAME","time"),onChangeCurrentTime:E("CHANGE_VIDEO_TIME","newTime"),currentTime:n.currentVideoTime,duration:n.videoDuration,keyframes:n.keyframes}),r().createElement(kn,{history:n.history,onRestoreHistory:E("RESTORE_HISTORY")})].filter(Boolean)},S),r().createElement(Ue,{open:n.settingsOpen,onClose:function(){return i({type:"HEADER_BUTTON_CLICKED",buttonName:"Settings"})}}))))};function Cn(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Rn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Rn(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function Rn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var Ln={BEGIN_BOX_TRANSFORM:"Transform/Move Box",BEGIN_MOVE_POINT:"Move Point",DELETE_REGION:"Delete Region"},Dn=function(e,t){return(0,H.updateIn)(e,["history"],(function(n){return[{time:xn()().toDate(),state:(0,H.without)(e,"history"),name:t}].concat((n||[]).slice(0,9))}))};function Pn(e,t,n){return e<=t?t:e>=n?n:e}const jn=function(e){var t=e.expandingWidth||.005,n=e.points.map((function(n,o){var r=n.x,i=n.y,a=n.angle,s=n.width;if(!a){var l=e.points[Pn(o+1,0,e.points.length-1)],c=e.points[Pn(o-1,0,e.points.length-1)];a=Math.atan2(c.x-l.x,c.y-l.y)+Math.PI/2}var u=Math.sin(a)*(s||t)/2,d=Math.cos(a)*(s||t)/2;return[{x:r+u,y:i+d},{x:r-u,y:i-d}]})),o=n.map((function(e){var t=(0,u.Z)(e,2),n=t[0];return t[1],n})),r=n.map((function(e){var t=(0,u.Z)(e,2);return t[0],t[1]})).asMutable();r.reverse();var i=o.concat(r).map((function(e){return[e.x,e.y]}));return(0,y.Z)({},e,{type:"polygon",open:!1,points:i,unfinished:void 0,candidatePoint:void 0})};var zn=n(5627),Bn=n.n(zn);function Wn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}const Gn=function(e){var t,n=e.center,o=e.scale,r=e.landmarks,i={},a=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Wn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Wn(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}(Object.entries(r));try{for(a.s();!(t=a.n()).done;){var s=t.value,l=(0,u.Z)(s,2),c=l[0],d=l[1].defaultPosition;i[c]={x:d[0]*o+n.x,y:d[1]*o+n.y}}}catch(e){a.e(e)}finally{a.f()}return i};var Hn=function(){return Math.random().toString().split(".")[1]};const Vn=function(e,t){if(e.allowedArea&&"modify-allowed-area"!==e.selectedTool&&["MOUSE_DOWN","MOUSE_UP","MOUSE_MOVE"].includes(t.type)){var n=e.allowedArea;t.x=Bn()(t.x,n.x,n.x+n.w),t.y=Bn()(t.y,n.y,n.y+n.h)}if("ON_CLS_ADDED"===t.type&&t.cls&&""!==t.cls){var o=e.regionClsList;return(0,y.Z)({},e,{regionClsList:o.concat(t.cls)})}if("MOUSE_MOVE"===t.type){if(Date.now()-(e.lastMouseMoveCall||0)<16)return e;e=(0,H.setIn)(e,["lastMouseMoveCall"],Date.now())}t.type.includes("MOUSE")||(e=(0,H.setIn)(e,["lastAction"],t));var r,i=Ye(e),a=i.currentImageIndex,s=i.pathToActiveImage,l=i.activeImage,d=function(e){var t="string"==typeof e||"number"==typeof e?e:e.id;if(!l)return null;var n=(l.regions||[]).findIndex((function(e){return e.id===t}));return-1===n?null:n},g=function(e){if(!l)return null;var t=d(e);return null===t?[null,null]:[l.regions[t],t]},m=function(t,n){var o=g(t),r=(0,u.Z)(o,2),i=r[0],a=r[1];if(!i)return e;if(null!==n)return(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions",a]),(0,y.Z)({},i,n));var d=l.regions;return(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions"]),(d||[]).filter((function(e){return e.id!==i.id})))},f=function(e){return null===a?e:(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions"]),(l.regions||[]).map((function(e){return(0,y.Z)({},e,{editingLabels:!1})})))},h=function(t,n){var o="object"===(0,M.Z)(t)?t:{src:t},r=(o.src,o.frameTime);return(0,H.setIn)((0,H.setIn)(e,["selectedImage"],n),["selectedImageFrameTime"],r)};switch(t.type){case"@@INIT":return e;case"SELECT_IMAGE":return h(t.image,t.imageIndex);case"CHANGE_REGION":var p=d(t.region);if(null===p)return e;var v=l.regions[p];if(v.cls!==t.region.cls){var E=(e=Dn(e,"Change Region Classification")).regionClsList.indexOf(t.region.cls);-1!==E&&(t.region.color=ce[E%ce.length])}return tn()(v.tags,t.region.tags)||(e=Dn(e,"Change Region Tags")),(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions",p]),t.region);case"CHANGE_IMAGE":if(!l)return e;for(var b=t.delta,w=0,x=Object.keys(b);w<x.length;w++){var I=x[w];"cls"===I&&Dn(e,"Change Image Class"),"tags"===I&&Dn(e,"Change Image Tags"),e=(0,H.setIn)(e,[].concat((0,c.Z)(s),[I]),b[I])}return e;case"SELECT_REGION":var Z=t.region;if(null===d(t.region))return e;var T=(0,c.Z)(l.regions||[]).map((function(e){return(0,y.Z)({},e,{highlighted:e.id===Z.id,editingLabels:e.id===Z.id})}));return(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions"]),T);case"BEGIN_MOVE_POINT":return e=f(e),(0,H.setIn)(e,["mode"],{mode:"MOVE_REGION",regionId:t.point.id});case"BEGIN_BOX_TRANSFORM":var k=t.box,O=t.directions;return e=f(e),0===O[0]&&0===O[1]?(0,H.setIn)(e,["mode"],{mode:"MOVE_REGION",regionId:k.id}):(0,H.setIn)(e,["mode"],{mode:"RESIZE_BOX",regionId:k.id,freedom:O,original:{x:k.x,y:k.y,w:k.w,h:k.h}});case"BEGIN_MOVE_POLYGON_POINT":var S=t.polygon,N=t.pointIndex;return(e=f(e)).mode&&"DRAW_POLYGON"===e.mode.mode&&0===N?(0,H.setIn)(m(S,{points:S.points.slice(0,-1),open:!1}),["mode"],null):(e=Dn(e,"Move Polygon Point"),(0,H.setIn)(e,["mode"],{mode:"MOVE_POLYGON_POINT",regionId:S.id,pointIndex:N}));case"BEGIN_MOVE_KEYPOINT":var _=t.region,A=t.keypointId;return e=f(e),e=Dn(e,"Move Keypoint"),(0,H.setIn)(e,["mode"],{mode:"MOVE_KEYPOINT",regionId:_.id,keypointId:A});case"ADD_POLYGON_POINT":var C=t.polygon,R=t.point,L=t.pointIndex,D=d(C);if(null===D)return e;var P=(0,c.Z)(C.points);return P.splice(L,0,R),(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions",D]),(0,y.Z)({},C,{points:P}));case"MOUSE_MOVE":var j=t.x,z=t.y;if(!e.mode)return e;if(!l)return e;switch(e.mouseDownAt,e.mode.mode){case"MOVE_POLYGON_POINT":var B=e.mode,W=B.pointIndex,G=B.regionId,V=d(G);return null===V?e:(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions",V,"points",W]),[j,z]);case"MOVE_KEYPOINT":var U=e.mode,F=U.keypointId,Y=U.regionId,K=g(Y),X=(0,u.Z)(K,2),q=X[0],J=X[1];return null===J?e:(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions",J,"points",F]),(0,y.Z)({},q.points[F],{x:j,y:z}));case"MOVE_REGION":var $=e.mode.regionId;if("$$allowed_area"===$){var Q=e.allowedArea,ee=Q.w,te=Q.h;return(0,H.setIn)(e,["allowedArea"],{x:j-ee/2,y:z-te/2,w:ee,h:te})}var ne=d($);return null===ne?e:(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions",ne]),function(e,t,n){switch(e.type){case"point":return(0,y.Z)({},e,{x:t,y:n});case"box":return(0,y.Z)({},e,{x:t-e.w/2,y:n-e.h/2})}return e}(l.regions[ne],j,z));case"RESIZE_BOX":var oe=e.mode,re=oe.regionId,ie=(0,u.Z)(oe.freedom,2),ae=ie[0],se=ie[1],le=oe.original,ue=le.x,de=le.y,ge=le.w,me=le.h,fe=0===ae?ue:-1===ae?Math.min(ue+ge,j):ue,he=0===ae?ge:-1===ae?ge+(ue-fe):Math.max(0,ge+(j-ue-ge)),pe=0===se?de:-1===se?Math.min(de+me,z):de,ye=0===se?me:-1===se?me+(de-pe):Math.max(0,me+(z-de-me));if(he<=.001&&(e=(0,H.setIn)(e,["mode","freedom"],[-1*ae,se])),ye<=.001&&(e=(0,H.setIn)(e,["mode","freedom"],[ae,-1*se])),"$$allowed_area"===re)return(0,H.setIn)(e,["allowedArea"],{x:fe,w:he,y:pe,h:ye});var ve=d(re);if(null===ve)return e;var Ee=l.regions[ve];return(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions",ve]),(0,y.Z)({},Ee,{x:fe,w:he,y:pe,h:ye}));case"RESIZE_KEYPOINTS":var be=e.mode,we=be.regionId,xe=be.landmarks,Ie=be.centerX,Ze=be.centerY,Te=Math.sqrt(Math.pow(Ie-j,2)+Math.pow(Ze-z,2));return m(we,{points:Gn({landmarks:xe,center:{x:Ie,y:Ze},scale:Te/.15})});case"DRAW_POLYGON":var ke=e.mode.regionId,Oe=g(ke),Se=(0,u.Z)(Oe,2),Me=Se[0],Ne=Se[1];return Me?(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions",Ne,"points",Me.points.length-1]),[j,z]):(0,H.setIn)(e,["mode"],null);case"DRAW_EXPANDING_LINE":var _e=e.mode.regionId,Ae=g(_e),Ce=(0,u.Z)(Ae,2),Re=Ce[0],Le=Ce[1];if(!Re)return e;if(Boolean(e.mouseDownAt)){var De=Re.points.slice(-1)[0],Pe=Math.sqrt(Math.pow(De.x-j,2)+Math.pow(De.y-z,2));return Pe<.002&&!De.width?e:(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions",Le,"points"]),Re.points.slice(0,-1).concat([(0,y.Z)({},De,{width:2*Pe,angle:Math.atan2(De.x-j,De.y-z)})]))}return(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions",Le]),(0,y.Z)({},Re,{candidatePoint:{x:j,y:z}}));case"SET_EXPANDING_LINE_WIDTH":var je=e.mode.regionId,ze=g(je),Be=(0,u.Z)(ze,2),We=Be[0],Ge=Be[1];if(!We)return e;var He=We.points.slice(-1)[0];return e.mouseDownAt,(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions",Ge,"expandingWidth"]),Math.sqrt(Math.pow(He.x-j,2)+Math.pow(He.y-z,2)));default:return e}case"MOUSE_DOWN":if(!l)return e;var Ve,Ue=t.x,Fe=t.y;if((e=(0,H.setIn)(e,["mouseDownAt"],{x:Ue,y:Fe})).mode)switch(e.mode.mode){case"DRAW_POLYGON":var Ke=g(e.mode.regionId),Xe=(0,u.Z)(Ke,2),qe=Xe[0],Je=Xe[1];if(!qe)break;return(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions",Je]),(0,y.Z)({},qe,{points:qe.points.concat([[Ue,Fe]])}));case"DRAW_EXPANDING_LINE":var $e=g(e.mode.regionId),Qe=(0,u.Z)($e,2),et=Qe[0],tt=Qe[1];if(!et)break;var nt=et.points.slice(-1)[0];return et.points.length>1&&Math.sqrt(Math.pow(nt.x-Ue,2)+Math.pow(nt.y-Fe,2))<.002?nt.width?e.setIn([].concat((0,c.Z)(s),["regions",tt]),jn(et)).setIn(["mode"],null):(0,H.setIn)(e,["mode"],{mode:"SET_EXPANDING_LINE_WIDTH",regionId:e.mode.regionId}):(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions",tt,"points"]),et.points.concat([{x:Ue,y:Fe,angle:null,width:null}]));case"SET_EXPANDING_LINE_WIDTH":var ot=g(e.mode.regionId),rt=(0,u.Z)(ot,2),it=rt[0],at=rt[1];if(!it)break;var st=it.expandingWidth;return e.setIn([].concat((0,c.Z)(s),["regions",at]),jn((0,y.Z)({},it,{points:it.points.map((function(e){return e.width?e:(0,y.Z)({},e,{width:st})})),expandingWidth:void 0}))).setIn(["mode"],null)}var lt=void 0,ct="#ff0000";if(l&&(l.regions||[]).length>0){lt=l.regions.slice(-1)[0].cls;var ut=(e.regionClsList||[]).indexOf(lt);-1!==ut&&(ct=ce[ut%ce.length])}switch(e.selectedTool){case"create-point":e=Dn(e,"Create Point"),Ve={type:"point",x:Ue,y:Fe,highlighted:!0,editingLabels:!0,color:ct,id:Hn(),cls:lt};break;case"create-box":e=Dn(e,"Create Box"),Ve={type:"box",x:Ue,y:Fe,w:0,h:0,highlighted:!0,editingLabels:!1,color:ct,cls:lt,id:Hn()},e=(0,H.setIn)(e,["mode"],{mode:"RESIZE_BOX",editLabelEditorAfter:!0,regionId:Ve.id,freedom:[1,1],original:{x:Ue,y:Fe,w:Ve.w,h:Ve.h},isNew:!0});break;case"create-polygon":if(e.mode&&"DRAW_POLYGON"===e.mode.mode)break;e=Dn(e,"Create Polygon"),Ve={type:"polygon",points:[[Ue,Fe],[Ue,Fe]],open:!0,highlighted:!0,color:ct,cls:lt,id:Hn()},e=(0,H.setIn)(e,["mode"],{mode:"DRAW_POLYGON",regionId:Ve.id});break;case"create-expanding-line":e=Dn(e,"Create Expanding Line"),Ve={type:"expanding-line",unfinished:!0,points:[{x:Ue,y:Fe,angle:null,width:null}],open:!0,highlighted:!0,color:ct,cls:lt,id:Hn()},e=(0,H.setIn)(e,["mode"],{mode:"DRAW_EXPANDING_LINE",regionId:Ve.id});break;case"create-keypoints":e=Dn(e,"Create Keypoints");var dt=Object.entries(e.keypointDefinitions),gt=(0,u.Z)(dt,1),mt=(0,u.Z)(gt[0],2),ft=mt[0],ht=mt[1],pt=ht.landmarks;ht.connections,Ve={type:"keypoints",keypointsDefinitionId:ft,points:Gn({landmarks:pt,center:{x:Ue,y:Fe},scale:1}),highlighted:!0,editingLabels:!1,id:Hn()},e=(0,H.setIn)(e,["mode"],{mode:"RESIZE_KEYPOINTS",landmarks:pt,centerX:Ue,centerY:Fe,regionId:Ve.id,isNew:!0})}var yt=(0,c.Z)((0,H.getIn)(e,s).regions||[]).map((function(e){return(0,H.setIn)(e,["editingLabels"],!1).setIn(["highlighted"],!1)})).concat(Ve?[Ve]:[]);return(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions"]),yt);case"MOUSE_UP":var vt=t.x,Et=t.y,bt=e.mouseDownAt,wt=void 0===bt?{x:vt,y:Et}:bt;if(!e.mode)return e;switch((e=(0,H.setIn)(e,["mouseDownAt"],null)).mode.mode){case"RESIZE_BOX":if(e.mode.isNew&&(Math.abs(e.mode.original.x-vt)<.002||Math.abs(e.mode.original.y-Et)<.002))return(0,H.setIn)(m(e.mode.regionId,null),["mode"],null);if(e.mode.editLabelEditorAfter)return(0,y.Z)({},m(e.mode.regionId,{editingLabels:!0}),{mode:null});case"MOVE_REGION":case"RESIZE_KEYPOINTS":case"MOVE_POLYGON_POINT":case"MOVE_KEYPOINT":return(0,y.Z)({},e,{mode:null});case"CREATE_POINT_LINE":return e;case"DRAW_EXPANDING_LINE":var xt=g(e.mode.regionId),It=(0,u.Z)(xt,2),Zt=It[0],Tt=It[1];if(!Zt)return e;var kt,Ot=0!==Zt.points.length?Zt.points.slice(-1)[0]:wt;if(Zt.points.length>1&&Zt.points.slice(-2)[0],!(Math.sqrt(Math.pow(Ot.x-vt,2)+Math.pow(Ot.y-Et,2))>.002))return e;for(var St=(0,c.Z)(Zt.points),Mt=0;Mt<St.length-1;Mt++)St[Mt].width||(St[Mt]=(0,y.Z)({},St[Mt],{width:Ot.width}));return kt=(0,H.setIn)(Zt,["points"],St),(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions",Tt]),kt);default:return e}case"OPEN_REGION_EDITOR":t.region;var Nt=d(t.region);if(null===Nt)return e;var _t=(0,H.setIn)(l.regions.map((function(e){return(0,y.Z)({},e,{highlighted:!1,editingLabels:!1})})),[Nt],(0,y.Z)({},(l.regions||[])[Nt],{highlighted:!0,editingLabels:!0}));return(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions"]),_t);case"CLOSE_REGION_EDITOR":t.region;var At=d(t.region);return null===At?e:(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions",At]),(0,y.Z)({},(l.regions||[])[At],{editingLabels:!1}));case"DELETE_REGION":return null===d(t.region)?e:(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions"]),(l.regions||[]).filter((function(e){return e.id!==t.region.id})));case"DELETE_SELECTED_REGION":return(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions"]),(l.regions||[]).filter((function(e){return!e.highlighted})));case"HEADER_BUTTON_CLICKED":switch(t.buttonName.toLowerCase()){case"prev":return null===a||0===a?e:h(e.images[a-1],a-1);case"next":return null===a||a===e.images.length-1?e:h(e.images[a+1],a+1);case"clone":return null===a||a===e.images.length-1?e:(0,H.setIn)(h(e.images[a+1],a+1),["images",a+1,"regions"],l.regions);case"settings":return(0,H.setIn)(e,["settingsOpen"],!e.settingsOpen);case"help":return e;case"fullscreen":return(0,H.setIn)(e,["fullScreen"],!0);case"exit fullscreen":case"window":return(0,H.setIn)(e,["fullScreen"],!1);case"hotkeys":return e;case"exit":case"done":default:return e}case"SELECT_TOOL":return"show-tags"===t.selectedTool?(r=!e.showTags,window.localStorage.setItem("__REACT_IMAGE_ANNOTATE_".concat("showTags"),JSON.stringify(r)),(0,H.setIn)(e,["showTags"],!e.showTags)):"show-mask"===t.selectedTool?(0,H.setIn)(e,["showMask"],!e.showMask):("modify-allowed-area"!==t.selectedTool||e.allowedArea||(e=(0,H.setIn)(e,["allowedArea"],{x:0,y:0,w:1,h:1})),e=(0,H.setIn)(e,["mode"],null),(0,H.setIn)(e,["selectedTool"],t.selectedTool));case"CANCEL":var Ct=e.mode;if(Ct)switch(Ct.mode){case"DRAW_EXPANDING_LINE":case"SET_EXPANDING_LINE_WIDTH":case"DRAW_POLYGON":return m(Ct.regionId,null);case"MOVE_POLYGON_POINT":case"RESIZE_BOX":case"MOVE_REGION":return(0,H.setIn)(e,["mode"],null);default:return e}var Rt=l.regions;if(Rt&&Rt.some((function(e){return e.editingLabels})))return(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions"]),Rt.map((function(e){return(0,y.Z)({},e,{editingLabels:!1})})));if(Rt)return(0,H.setIn)(e,[].concat((0,c.Z)(s),["regions"]),Rt.map((function(e){return(0,y.Z)({},e,{highlighted:!1})})))}return e},Un=function(e,t){var n=Ye(e),o=n.currentImageIndex;switch(n.pathToActiveImage,n.activeImage,t.type){case"IMAGE_OR_VIDEO_LOADED":return(0,H.setIn)(e,["images",o,"pixelSize"],{w:t.metadata.naturalWidth,h:t.metadata.naturalHeight})}return e},Fn=function(e,t){var n=function(){return(0,H.setIn)(Dn(e,"Add Keyframe"),["keyframes",e.currentVideoTime||0],{regions:Je(e.keyframes,e.currentVideoTime)})};switch(t.type){case"IMAGE_OR_VIDEO_LOADED":var o=t.metadata.duration;if("number"==typeof o)return(0,H.setIn)(e,["videoDuration"],1e3*o);case"HEADER_BUTTON_CLICKED":switch(t.buttonName.toLowerCase()){case"play":return(0,H.setIn)(e,["videoPlaying"],!0);case"pause":return(0,H.setIn)(e,["videoPlaying"],!1)}case"CHANGE_VIDEO_TIME":return(0,H.setIn)(e,["currentVideoTime"],t.newTime);case"CHANGE_VIDEO_PLAYING":return(0,H.setIn)(e,["videoPlaying"],t.isPlaying);case"DELETE_KEYFRAME":return(0,H.setIn)(e,["keyframes"],(0,H.without)(e.keyframes,t.time))}if(!e.keyframes[e.currentVideoTime])switch(t.type){case"BEGIN_BOX_TRANSFORM":case"BEGIN_MOVE_POINT":case"BEGIN_MOVE_KEYPOINT":case"BEGIN_MOVE_POLYGON_POINT":case"ADD_POLYGON_POINT":case"SELECT_REGION":case"CHANGE_REGION":case"DELETE_REGION":case"OPEN_REGION_EDITOR":return n();case"MOUSE_DOWN":switch(e.selectedTool){case"create-point":case"create-polygon":case"create-box":case"create-keypoints":return n()}}return e},Yn=function(e){var t=e.images,n=e.allowedArea,i=e.selectedImage,a=void 0===i?t&&t.length>0?0:void 0:i,s=e.showPointDistances,l=e.pointDistancePrecision,c=e.showTags,d=void 0===c?function(e,t){try{return JSON.parse(window.localStorage["__REACT_IMAGE_ANNOTATE_".concat("showTags")])}catch(e){return!0}}():c,g=e.enabledTools,m=void 0===g?["select","create-point","create-box","create-polygon","create-expanding-line","show-mask"]:g,f=e.selectedTool,h=void 0===f?"select":f,p=e.regionTagList,v=void 0===p?[]:p,E=e.regionClsList,b=void 0===E?[]:E,w=e.imageTagList,x=void 0===w?[]:w,I=e.imageClsList,T=void 0===I?[]:I,k=e.keyframes,O=void 0===k?{}:k,S=e.taskDescription,M=void 0===S?"":S,N=e.fullImageSegmentationMode,_=void 0!==N&&N,A=e.RegionEditLabel,C=e.videoSrc,R=e.videoTime,L=void 0===R?0:R,D=e.videoName,P=e.onExit,j=e.onNextImage,z=e.onPrevImage,B=e.keypointDefinitions,W=e.autoSegmentationOptions,G=void 0===W?{type:"autoseg"}:W,U=e.hideHeader,F=e.hideHeaderText,Y=e.hideNext,K=e.hidePrev;"string"==typeof a&&-1===(a=(t||[]).findIndex((function(e){return e.src===a})))&&(a=void 0);var X,q=t?"image":"video",J=(0,o.useReducer)((X=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e,n){var o,r=Cn(t);try{for(r.s();!(o=r.n()).done;)e=(0,o.value)(e,n)}catch(e){r.e(e)}finally{r.f()}return e}}("image"===q?Un:Fn,Vn),function(e,t){var n=e,o=X(e,t);if("RESTORE_HISTORY"===t.type){if(e.history.length>0)return(0,H.setIn)(o.history[0].state,["history"],o.history.slice(1))}else if(n!==o&&Object.keys(Ln).includes(t.type))return(0,H.setIn)(o,["history"],[{time:xn()().toDate(),state:(0,H.without)(n,"history"),name:Ln[t.type]||t.type}].concat(o.history||[]).slice(0,9));return o}),V()((0,y.Z)({annotationType:q,showTags:d,allowedArea:n,showPointDistances:s,pointDistancePrecision:l,selectedTool:h,fullImageSegmentationMode:_,autoSegmentationOptions:G,mode:null,taskDescription:M,showMask:!0,labelImages:T.length>0||x.length>0,regionClsList:b,regionTagList:v,imageClsList:T,imageTagList:x,currentVideoTime:L,enabledTools:m,history:[],videoName:D,keypointDefinitions:B},"image"===q?{selectedImage:a,images:t,selectedImageFrameTime:t&&t.length>0?t[0].frameTime:void 0}:{videoSrc:C,keyframes:O}))),$=(0,u.Z)(J,2),Q=$[0],ee=$[1],te=(0,Z.Z)((function(e){if("HEADER_BUTTON_CLICKED"===e.type){if(["Exit","Done","Save","Complete"].includes(e.buttonName))return P((0,H.without)(Q,"history"));if("Next"===e.buttonName&&j)return j((0,H.without)(Q,"history"));if("Prev"===e.buttonName&&z)return z((0,H.without)(Q,"history"))}ee(e)})),ne=(0,Z.Z)((function(e){ee({type:"ON_CLS_ADDED",cls:e})}));return(0,o.useEffect)((function(){void 0!==a&&ee({type:"SELECT_IMAGE",imageIndex:a,image:Q.images[a]})}),[a]),t||C?r().createElement(Ze,null,r().createElement(An,{RegionEditLabel:A,alwaysShowNextButton:Boolean(j),alwaysShowPrevButton:Boolean(z),state:Q,onSelectRegion:e.onSelectRegion,onDeleteRegion:e.onDeleteRegion,dispatch:te,onRegionClassAdded:ne,hideHeader:U,hideHeaderText:F,hideNext:Y,hidePrev:K})):'Missing required prop "images" or "videoSrc"'};var Kn=n(55877),Xn=n.n(Kn),qn=n(23198),Jn=n(75073);function $n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Qn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$n(Object(n),!0).forEach((function(t){(0,s.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$n(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function eo(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return to(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?to(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function to(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var no=n(51657).DataFactory,oo=no.namedNode,ro=no.literal,io=(no.defaultGraph,no.quad,n(81092).newEngine),ao=(0,m.Z)({productionPrefix:"img_a",seed:"img_a"});const so=function(e){var t=e.sharedProps,n=e.module,i=e.inactive,a=t.selectedElements,s=t.activeResources,d=t.projects,m=t.store,y=t.session,v=t.trigger,E=(0,o.useState)(null),b=(0,u.Z)(E,2),w=b[0],x=b[1],I=(0,o.useState)([]),Z=(0,u.Z)(I,2),T=Z[0],k=Z[1],O=(0,o.useState)(0),S=(0,u.Z)(O,2),M=S[0],N=S[1],_=(0,o.useState)(Xn()()),A=(0,u.Z)(_,2),C=A[0],R=A[1],L=(0,o.useState)([]),D=(0,u.Z)(L,2),P=D[0],j=D[1],z=(0,o.useState)([]),B=(0,u.Z)(z,2),W=B[0],G=B[1],H=(0,o.useState)([]),V=(0,u.Z)(H,2),U=(V[0],V[1],(0,o.useState)("")),F=(0,u.Z)(U,2),Y=(F[0],F[1],d[0]);function K(){return(K=(0,l.Z)(g().mark((function e(t){var n,o,r,i,s,l,u;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=io(),o=[],r={},i=eo(a),e.prev=4,l=g().mark((function e(){var i,a,l;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=s.value,a="\n      PREFIX lbd: <https://lbdserver.org/vocabulary#> \n      SELECT DISTINCT ?region WHERE {\n        <".concat(i.global[0],"> lbd:hasLinkElement ?le .\n        ?le lbd:hasIdentifier ?id ;\n            lbd:hasDocument <").concat(t.src,"> .\n        ?id lbd:identifier ?region .\n      }"),e.next=4,n.query(a,{sources:[m]});case 4:return l=e.sent,e.next=7,l.bindings();case 7:e.sent.forEach((function(e){var t,n=i.global[0].split("/lbd/")[0]+"/profile/card#me";Object.keys(r).includes(n)?t=r[n].color:(t=q(),r[n]={color:t}),o.push(Qn(Qn({},JSON.parse(e.get("?region").id.replaceAll('"',"").replaceAll("'",'"'))),{},{artefact:i.global[0],cls:n,color:t,id:Xn()(),tags:[i.global[0]],loaded:!0}))}));case 9:case"end":return e.stop()}}),e)})),i.s();case 7:if((s=i.n()).done){e.next=11;break}return e.delegateYield(l(),"t0",9);case 9:e.next=7;break;case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(4),i.e(e.t1);case 16:return e.prev=16,i.f(),e.finish(16);case 19:(u=T)[M].regions=o,k(u),j((function(e){return[].concat((0,c.Z)(e),(0,c.Z)(Object.keys(r)))})),R(Xn()());case 24:case"end":return e.stop()}}),e,null,[[4,13,16,19]])})))).apply(this,arguments)}function X(){return(X=(0,l.Z)(g().mark((function e(t){var n,o,r,i,a,s,l;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=io(),o="\n       PREFIX lbd: <https://lbdserver.org/vocabulary#> \n       SELECT ?region ?artefact WHERE {\n         ?artefact lbd:hasLinkElement ?le .\n         ?le lbd:hasIdentifier ?id ;\n             lbd:hasDocument <".concat(t.src,"> .\n         ?id lbd:identifier ?region .\n       }"),e.next=5,n.query(o,{sources:[m]});case 5:return r=e.sent,e.next=8,r.bindings();case 8:i=e.sent,console.log("bindings1",i),a={},s=i.map((function(e){var t,n=e.get("?artefact").id,o=n.split("lbd")[0]+"profile/card#me";return Object.keys(a).includes(o)?t=a[o].color:(t=q(),a[o]={color:t}),Qn(Qn({},JSON.parse(e.get("?region").id.replaceAll('"',"").replaceAll("'",'"'))),{},{artefact:n,cls:o,color:t,id:Xn()(),tags:[n],loaded:!0})})),(l=T)[M].regions=s,k(l),j((function(e){return[].concat((0,c.Z)(e),(0,c.Z)(Object.keys(a)))})),R(Xn()()),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(0),console.log("error in imageAnnotator - get associated regions",e.t0);case 22:case"end":return e.stop()}}),e,null,[[0,19]])})))).apply(this,arguments)}function q(){for(var e="#",t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}function J(){return(J=(0,l.Z)(g().mark((function e(){var t,n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,qn.getLBDlocation)(y.info.webId,y);case 2:return t=e.sent,e.next=5,(0,qn.getProjectId)(Y,y);case 5:n=e.sent,x(t+n+"/artefactRegistry.ttl");case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}if((0,o.useEffect)((function(){var e=(0,c.Z)(s).filter((function(e){return p.lookup(e.main).includes("image")})).map((function(e){return{src:e.main,metadata:e.metadata,artefactRegistry:e.artefactRegistry,name:e.main.split("/")[e.main.split("/").length-1],regions:[]}}));JSON.stringify(e)!==JSON.stringify(T)&&(k(e),N(0),R(Xn()()))}),[s]),(0,o.useEffect)((function(){y.info.isLoggedIn?(function(){J.apply(this,arguments)}(),j([].concat((0,c.Z)(P),[y.info.webId])),G(["select","create-box","create-polygon","create-line","show-mask"]),R(Xn()())):j([])}),[v]),(0,o.useEffect)((function(){if(T[M]){var e=T;e[M].regions=[],k(e),R(Xn()())}}),[a]),i||0===T.length)return r().createElement(r().Fragment,null);function $(){return($=(0,l.Z)(g().mark((function e(t){var n,o,r,i,s,l,c,u,d,f,h,p,v,E,b,x;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!w){e.next=64;break}n=eo(t.images),e.prev=2,n.s();case 4:if((o=n.n()).done){e.next=56;break}r=o.value,i=eo(r.regions),e.prev=7,i.s();case 9:if((s=i.n()).done){e.next=46;break}if((l=s.value).loaded){e.next=44;break}return c=l.type,void 0,u="box"===c?{type:c,x:l.x,y:l.y,w:l.w,h:l.h}:{type:c,points:l.points},d=Xn()(),f=Xn()(),h=Xn()(),p="\n        PREFIX lbd: <https://lbdserver.org/vocabulary#> \n        INSERT DATA {\n          <#".concat(d,"> lbd:hasLinkElement <#").concat(f,"> .\n          <#").concat(f,"> lbd:hasIdentifier <#").concat(h,"> ;\n              lbd:hasDocument <").concat(r.src,"> .\n          <#").concat(h,'> lbd:identifier "').concat(JSON.stringify(u).replaceAll('"',"'"),'" .\n        }'),e.next=21,(0,qn.update)(p,w,y);case 21:if(m.addQuad(oo(w+"#".concat(d)),oo("https://lbdserver.org/vocabulary#hasLinkElement"),oo(w+"#".concat(f))),m.addQuad(oo(w+"#".concat(f)),oo("https://lbdserver.org/vocabulary#hasIdentifier"),oo(w+"#".concat(h))),m.addQuad(oo(w+"#".concat(f)),oo("https://lbdserver.org/vocabulary#hasDocument"),oo(r.src)),m.addQuad(oo(w+"#".concat(h)),oo("https://lbdserver.org/vocabulary#identifier"),ro(JSON.stringify(l).replaceAll('"',"'"))),!(a.length>0)){e.next=44;break}v=eo(a),e.prev=27,v.s();case 29:if((E=v.n()).done){e.next=36;break}return b=E.value,x="\n              PREFIX lbd: <https://lbdserver.org/vocabulary#> \n              PREFIX owl: <http://www.w3.org/2002/07/owl#>\n              INSERT DATA {\n                <#".concat(d,"> owl:sameAs <").concat(b.global[0],"> .\n                <").concat(b.global[0],"> owl:sameAs <#").concat(d,"> .\n              }"),e.next=34,(0,qn.update)(x,w,y);case 34:e.next=29;break;case 36:e.next=41;break;case 38:e.prev=38,e.t0=e.catch(27),v.e(e.t0);case 41:return e.prev=41,v.f(),e.finish(41);case 44:e.next=9;break;case 46:e.next=51;break;case 48:e.prev=48,e.t1=e.catch(7),i.e(e.t1);case 51:return e.prev=51,i.f(),e.finish(51);case 54:e.next=4;break;case 56:e.next=61;break;case 58:e.prev=58,e.t2=e.catch(2),n.e(e.t2);case 61:return e.prev=61,n.f(),e.finish(61);case 64:case"end":return e.stop()}}),e,null,[[2,58,61,64],[7,48,51,54],[27,38,41,44]])})))).apply(this,arguments)}function Q(){return(Q=(0,l.Z)(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("e",t),M<T.length&&N((function(e){return e+1})),R(Xn()());case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(){return(ee=(0,l.Z)(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("e",t),M>0&&N((function(e){return e-1})),console.log(t.images[M]),R(Xn()());case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return r().createElement("div",{id:C,style:{width:n.dimensions.w-2,height:n.dimensions.h-100}},r().createElement(f.ZP,{generateClassName:ao},r().createElement(Yn,{key:C,selectedImage:M,onSelectRegion:function(e){return console.log("region",e)},images:T,regionClsList:P,showTags:!0,onExit:function(e){return function(e){return $.apply(this,arguments)}(e)},enabledTools:W,allowComments:!0,onNextImage:function(e){return Q.apply(this,arguments)},onPrevImage:function(e){return ee.apply(this,arguments)},hideNext:!(M<T.length-1),hidePrev:0===M||T.length<2}),r().createElement(h.Button,{variant:"contained",color:"primary",style:{margin:10},onClick:function(){return function(e){return X.apply(this,arguments)}(T[M])}},"Get all zones"),r().createElement(h.Button,{variant:"contained",color:"primary",style:{margin:10},onClick:function(){return function(e){return K.apply(this,arguments)}(T[M])}},"Get associated regions")))};var lo=n(24853),co=n(51657),uo=((0,lo.atom)({key:"session",default:new Jn.Session}),(0,lo.atom)({key:"store",default:new co.Store})),go=(0,lo.atom)({key:"projects",default:["http://localhost:5000/jeroen/lbd/642f0417-ce23-4d9d-8806-c078aed93ae1/"]}),mo=(0,lo.atom)({key:"activeResources",default:[{main:"http://localhost:5000/pieter/lbd/642f0417-ce23-4d9d-8806-c078aed93ae1/damage.jpeg",meta:"http://localhost:5000/pieter/lbd/642f0417-ce23-4d9d-8806-c078aed93ae1/damage.jpeg.props.ttl"}]}),fo=(0,lo.atom)({key:"selectedElements",default:[]}),ho=(0,lo.atom)({key:"selectionId",default:""}),po=(0,lo.atom)({key:"trigger",default:"0"}),yo=n(60698),vo=n(89875),Eo=n(2576),bo=n(60306),wo=n(60306),xo=function(e,t,n){var o;if(n)o=r().createElement(n,null);else{var i={};t&&(i=t),o=r().createElement(so,i)}a().render(o,e)},Io=document.querySelector("#"+wo.name);Io&&(console.log(Io),xo(Io,{},(function(){var e={url:bo.domain,scope:bo.name,label:bo.name,module:"./index",dimensions:{x:0,y:0,h:850,w:900}},t=function(e,t){return function(){var n=(0,o.useState)(!0),i=(0,u.Z)(n,2),a=i[0],s=i[1],l=(0,lo.useRecoilState)(mo),c=(0,u.Z)(l,2),d=c[0],g=c[1],m=(0,lo.useRecoilState)(fo),f=(0,u.Z)(m,2),p=f[0],y=f[1],v=(0,lo.useRecoilState)(go),E=(0,u.Z)(v,2),b=E[0],w=E[1],x=(0,lo.useRecoilState)(ho),I=(0,u.Z)(x,2),Z=I[0],T=I[1],k=(0,lo.useRecoilState)(po),O=(0,u.Z)(k,2),S=O[0],M=O[1],N=(0,lo.useRecoilValue)(uo),_={projects:b,setProjects:w,activeResources:d,setActiveResources:g,selectedElements:p,setSelectedElements:y,selectionId:Z,setSelectionId:T,trigger:S,setTrigger:M,store:N};return r().createElement("div",null,r().createElement(h.IconButton,{style:{position:"absolute",right:a?450:0},variant:"contained",color:"primary",onClick:function(){return s(!a)}},a?r().createElement(r().Fragment,null):r().createElement(vo.default,null)),r().createElement(Eo.Options,{openOptions:a,setOpenOptions:s,trigger:S,setTrigger:M,projects:b,setProjects:w,store:N,drawerWidth:"25%"})," ",r().createElement(e,{sharedProps:_,module:t,children:null,inactive:!1}))}}(so,e);return r().createElement("div",{style:{width:e.dimensions.w,height:e.dimensions.h}},r().createElement(lo.RecoilRoot,null,r().createElement(yo.QueryClientProvider,{client:new yo.QueryClient},r().createElement(t,{module:e}))))})));const Zo=xo},46700:(e,t,n)=>{var o={"./af":42786,"./af.js":42786,"./ar":30867,"./ar-dz":14130,"./ar-dz.js":14130,"./ar-kw":96135,"./ar-kw.js":96135,"./ar-ly":56440,"./ar-ly.js":56440,"./ar-ma":47702,"./ar-ma.js":47702,"./ar-sa":16040,"./ar-sa.js":16040,"./ar-tn":37100,"./ar-tn.js":37100,"./ar.js":30867,"./az":31083,"./az.js":31083,"./be":9808,"./be.js":9808,"./bg":68338,"./bg.js":68338,"./bm":67438,"./bm.js":67438,"./bn":8905,"./bn-bd":76225,"./bn-bd.js":76225,"./bn.js":8905,"./bo":11560,"./bo.js":11560,"./br":1278,"./br.js":1278,"./bs":80622,"./bs.js":80622,"./ca":2468,"./ca.js":2468,"./cs":5822,"./cs.js":5822,"./cv":50877,"./cv.js":50877,"./cy":47373,"./cy.js":47373,"./da":24780,"./da.js":24780,"./de":59740,"./de-at":60217,"./de-at.js":60217,"./de-ch":60894,"./de-ch.js":60894,"./de.js":59740,"./dv":5300,"./dv.js":5300,"./el":50837,"./el.js":50837,"./en-au":78348,"./en-au.js":78348,"./en-ca":77925,"./en-ca.js":77925,"./en-gb":22243,"./en-gb.js":22243,"./en-ie":46436,"./en-ie.js":46436,"./en-il":47207,"./en-il.js":47207,"./en-in":44175,"./en-in.js":44175,"./en-nz":76319,"./en-nz.js":76319,"./en-sg":31662,"./en-sg.js":31662,"./eo":92915,"./eo.js":92915,"./es":55655,"./es-do":55251,"./es-do.js":55251,"./es-mx":96112,"./es-mx.js":96112,"./es-us":71146,"./es-us.js":71146,"./es.js":55655,"./et":5603,"./et.js":5603,"./eu":77763,"./eu.js":77763,"./fa":76959,"./fa.js":76959,"./fi":11897,"./fi.js":11897,"./fil":42549,"./fil.js":42549,"./fo":94694,"./fo.js":94694,"./fr":15596,"./fr-ca":63049,"./fr-ca.js":63049,"./fr-ch":52330,"./fr-ch.js":52330,"./fr.js":15596,"./fy":5044,"./fy.js":5044,"./ga":29295,"./ga.js":29295,"./gd":2101,"./gd.js":2101,"./gl":38794,"./gl.js":38794,"./gom-deva":27884,"./gom-deva.js":27884,"./gom-latn":23168,"./gom-latn.js":23168,"./gu":95349,"./gu.js":95349,"./he":24206,"./he.js":24206,"./hi":30094,"./hi.js":30094,"./hr":30316,"./hr.js":30316,"./hu":22138,"./hu.js":22138,"./hy-am":11423,"./hy-am.js":11423,"./id":29218,"./id.js":29218,"./is":90135,"./is.js":90135,"./it":90626,"./it-ch":10150,"./it-ch.js":10150,"./it.js":90626,"./ja":39183,"./ja.js":39183,"./jv":24286,"./jv.js":24286,"./ka":12105,"./ka.js":12105,"./kk":47772,"./kk.js":47772,"./km":18758,"./km.js":18758,"./kn":79282,"./kn.js":79282,"./ko":33730,"./ko.js":33730,"./ku":1408,"./ku.js":1408,"./ky":33291,"./ky.js":33291,"./lb":36841,"./lb.js":36841,"./lo":55466,"./lo.js":55466,"./lt":57010,"./lt.js":57010,"./lv":37595,"./lv.js":37595,"./me":39861,"./me.js":39861,"./mi":35493,"./mi.js":35493,"./mk":95966,"./mk.js":95966,"./ml":87341,"./ml.js":87341,"./mn":5115,"./mn.js":5115,"./mr":10370,"./mr.js":10370,"./ms":9847,"./ms-my":41237,"./ms-my.js":41237,"./ms.js":9847,"./mt":72126,"./mt.js":72126,"./my":56165,"./my.js":56165,"./nb":64924,"./nb.js":64924,"./ne":16744,"./ne.js":16744,"./nl":93901,"./nl-be":59814,"./nl-be.js":59814,"./nl.js":93901,"./nn":83877,"./nn.js":83877,"./oc-lnc":92135,"./oc-lnc.js":92135,"./pa-in":15858,"./pa-in.js":15858,"./pl":64495,"./pl.js":64495,"./pt":89520,"./pt-br":57971,"./pt-br.js":57971,"./pt.js":89520,"./ro":96459,"./ro.js":96459,"./ru":21793,"./ru.js":21793,"./sd":40950,"./sd.js":40950,"./se":10490,"./se.js":10490,"./si":90124,"./si.js":90124,"./sk":64249,"./sk.js":64249,"./sl":14985,"./sl.js":14985,"./sq":51104,"./sq.js":51104,"./sr":49131,"./sr-cyrl":79915,"./sr-cyrl.js":79915,"./sr.js":49131,"./ss":85893,"./ss.js":85893,"./sv":98760,"./sv.js":98760,"./sw":91172,"./sw.js":91172,"./ta":27333,"./ta.js":27333,"./te":23110,"./te.js":23110,"./tet":52095,"./tet.js":52095,"./tg":27321,"./tg.js":27321,"./th":9041,"./th.js":9041,"./tk":19005,"./tk.js":19005,"./tl-ph":75768,"./tl-ph.js":75768,"./tlh":89444,"./tlh.js":89444,"./tr":72397,"./tr.js":72397,"./tzl":28254,"./tzl.js":28254,"./tzm":51106,"./tzm-latn":30699,"./tzm-latn.js":30699,"./tzm.js":51106,"./ug-cn":9288,"./ug-cn.js":9288,"./uk":67691,"./uk.js":67691,"./ur":13795,"./ur.js":13795,"./uz":6791,"./uz-latn":60588,"./uz-latn.js":60588,"./uz.js":6791,"./vi":65666,"./vi.js":65666,"./x-pseudo":14378,"./x-pseudo.js":14378,"./yo":75805,"./yo.js":75805,"./zh-cn":83839,"./zh-cn.js":83839,"./zh-hk":55726,"./zh-hk.js":55726,"./zh-mo":99807,"./zh-mo.js":99807,"./zh-tw":74152,"./zh-tw.js":74152};function r(e){var t=i(e);return n(t)}function i(e){if(!n.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}r.keys=function(){return Object.keys(o)},r.resolve=i,e.exports=r,r.id=46700},60306:e=>{"use strict";e.exports=JSON.parse('{"name":"imageannotator","port":8084,"version":"1.0.0","scripts":{"start":"webpack serve --config config/webpack.dev.js","build:dev":"webpack --config config/webpack.dev.js","build":"webpack --config config/webpack.prod.js"},"dependencies":{"@comunica/actor-init-sparql":"^1.22.0","@inrupt/solid-client-authn-browser":"^1.11.2","@material-ui/core":"^4.11.0","@material-ui/icons":"^4.9.1","@solid/query-ldflex":"^2.11.3","assert":"^2.0.0","browserify-zlib":"^0.2.0","buffer":"^6.0.3","consolid":"^1.0.7","consolid-react-ui":"0.0.12","crypto-browserify":"^3.12.0","events":"^3.3.0","mime-type":"^4.0.0","os-browserify":"^0.3.0","path":"^0.12.7","path-browserify":"^1.0.1","process":"^0.11.10","react":"^17.0.1","react-dom":"^17.0.1","react-image-annotate":"^1.7.10","react-query":"^3.24.4","react-router-dom":"^5.2.0","recoil":"^0.4.1","stream-browserify":"^3.0.0","styled-components":"^5.3.1","util":"^0.12.4"},"devDependencies":{"@babel/core":"^7.12.3","@babel/plugin-transform-runtime":"^7.12.1","@babel/preset-env":"^7.12.1","@babel/preset-react":"^7.12.1","babel-loader":"^8.1.0","clean-webpack-plugin":"^3.0.0","css-loader":"^5.0.0","html-webpack-plugin":"^4.5.0","style-loader":"^2.0.0","webpack":"^5.4.0","webpack-cli":"^4.7.0","webpack-dev-server":"^3.11.0","webpack-merge":"^5.2.0"}}')}}]);